---
phase: 05-dashboard-page-migration
plan: 02
type: execute
wave: 2
depends_on: ["05-01"]
files_modified:
  - components/dashboard/habit-checklist.tsx
  - components/dashboard/tasks-today.tsx
  - components/dashboard/absence-card.tsx
  - components/dashboard/weekly-insight-card.tsx
  - components/habits/milestone-card.tsx
  - components/habits/habit-row.tsx
  - tests/components/dashboard/tasks-today.test.tsx
autonomous: true

must_haves:
  truths:
    - "Habit checklist celebration section uses primary-based gradient instead of hardcoded emerald/teal"
    - "Absence card success state uses bg-highlight and text-primary instead of hardcoded emerald"
    - "Absence card variant colors (amber, blue, orange) are preserved as semantic colors"
    - "Weekly insight card keeps its distinct blue/indigo information styling"
    - "Milestone card uses primary-based gradient instead of hardcoded emerald/teal"
    - "HabitRow and TaskRow hover states use hover:bg-accent instead of hardcoded slate"
    - "Checkbox checked states use bg-primary/border-primary instead of hardcoded emerald"
    - "Tasks-today priority colors text-slate-400 migrated to text-muted-foreground"
  artifacts:
    - path: "components/dashboard/habit-checklist.tsx"
      provides: "Celebration gradient with primary tokens"
      contains: "from-primary/5"
    - path: "components/dashboard/tasks-today.tsx"
      provides: "Token-based colors for hover, checkbox, completion text"
      contains: "hover:bg-accent"
    - path: "components/dashboard/absence-card.tsx"
      provides: "Success state with primary/highlight tokens, variant colors preserved"
      contains: "bg-highlight"
    - path: "components/dashboard/weekly-insight-card.tsx"
      provides: "Blue information styling preserved, structural Card base"
      contains: "from-blue-50"
    - path: "components/habits/milestone-card.tsx"
      provides: "Primary-based celebration gradient"
      contains: "from-primary/5"
    - path: "components/habits/habit-row.tsx"
      provides: "Token-based hover and checkbox states"
      contains: "hover:bg-accent"
    - path: "tests/components/dashboard/tasks-today.test.tsx"
      provides: "Updated assertions for new token classes"
      contains: "text-muted-foreground"
  key_links:
    - from: "components/dashboard/habit-checklist.tsx"
      to: "components/habits/habit-row.tsx"
      via: "import { HabitRow }"
      pattern: "import.*HabitRow"
    - from: "components/dashboard/tasks-today.tsx"
      to: "design tokens"
      via: "Tailwind classes"
      pattern: "hover:bg-accent"
---

<objective>
Migrate the remaining dashboard detail components (habit checklist celebration, tasks-today, absence cards, weekly insight, milestone cards, habit row) to design tokens, and update all affected test assertions.

Purpose: Complete the dashboard's visual migration by replacing all remaining hardcoded colors in detail/shared components with design tokens, maintaining semantic color distinctions (amber/blue/orange warnings, blue information) per locked decisions.
Output: 6 migrated component files, 1 updated test file. Full dashboard renders with card-on-gray aesthetic.
</objective>

<execution_context>
@/home/xingdi/.claude/get-shit-done/workflows/execute-plan.md
@/home/xingdi/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/05-dashboard-page-migration/05-RESEARCH.md
@.planning/phases/05-dashboard-page-migration/05-01-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Migrate habit-checklist, absence-card, weekly-insight-card, and milestone-card</name>
  <files>
    components/dashboard/habit-checklist.tsx
    components/dashboard/absence-card.tsx
    components/dashboard/weekly-insight-card.tsx
    components/habits/milestone-card.tsx
  </files>
  <action>
In `components/dashboard/habit-checklist.tsx`:

1. **Migrate celebration section (lines 71-81):**
   - Replace the "perfect day" celebration div's classes:
     - `bg-gradient-to-br from-emerald-50 to-teal-50 dark:from-emerald-950/30 dark:to-teal-950/30 border border-emerald-200 dark:border-emerald-800/30`
     -> `bg-gradient-to-br from-primary/5 to-primary/10 dark:from-primary/10 dark:to-primary/20 border border-primary/20 dark:border-primary/30`
   - Line 72 icon background: `bg-emerald-100 dark:bg-emerald-900/50` -> `bg-primary/10`
   - Line 73 icon color: `text-emerald-600 dark:text-emerald-400` -> `text-primary`
   - Line 75 title text: `text-emerald-900 dark:text-emerald-100` -> `text-foreground`
   - Line 78 subtitle text: `text-emerald-700 dark:text-emerald-300` -> `text-primary`
   - Line 75 font size: `font-display text-lg font-bold` -> `text-section-heading font-bold` (section-heading includes fontWeight: 600, adding font-bold bumps to 700 for celebration emphasis; keep font-display for display font)

In `components/dashboard/absence-card.tsx`:

1. **Variant configs (lines 19-41) -- keep as-is:**
   - Per locked decision: "Absence recovery cards keep their warning/accent color styling." The amber/blue/orange variant colors are semantic (warning/info/caution) and must NOT become primary. Leave variantConfig completely unchanged.

2. **Migrate success (justCompleted) state (lines 71-78):**
   - `border-l-emerald-500` -> `border-l-primary`
   - `bg-emerald-50 dark:bg-emerald-950/20` -> `bg-highlight`
   - `text-emerald-500` (Check icon, line 73) -> `text-primary`
   - `text-emerald-700 dark:text-emerald-400` (text, line 74) -> `text-primary`

3. **Migrate checkbox checked state (line 108):**
   - `data-[state=checked]:bg-emerald-500 data-[state=checked]:border-emerald-500`
   -> `data-[state=checked]:bg-primary data-[state=checked]:border-primary`

In `components/dashboard/weekly-insight-card.tsx`:

1. **Per locked decision:** "Weekly insight card keeps its distinct styling, migrated to design tokens." The blue/indigo gradient and text colors serve as an "information" semantic accent distinct from the primary green.
2. **Keep ALL blue/indigo classes as-is** -- the gradient (`from-blue-50 to-indigo-50`), border (`border-blue-200`), text colors (`text-blue-900`, `text-blue-700`, `text-blue-600`), and hover/dismiss button colors are all semantic information colors.
3. **No changes needed** to this file. The Card base already provides bg-card which the gradient overlays. The dark mode variants are already handled.
4. NOTE: If the Card base classes conflict with the gradient (bg-card vs bg-gradient), the gradient className will override since it comes after in the className merge. This is correct behavior -- verified in research.

In `components/habits/milestone-card.tsx`:

1. **Migrate celebration gradient (line 32):**
   - `bg-gradient-to-r from-emerald-50 to-teal-50 border-emerald-200 dark:from-emerald-950/30 dark:to-teal-950/30 dark:border-emerald-800`
   -> `bg-gradient-to-r from-primary/5 to-primary/10 border-primary/20 dark:from-primary/10 dark:to-primary/20 dark:border-primary/30`

2. **Migrate icon (line 34):**
   - `bg-emerald-100 dark:bg-emerald-900/50` -> `bg-primary/10`

3. **Migrate icon color (line 35):**
   - `text-emerald-600 dark:text-emerald-400` -> `text-primary`

4. **Migrate text colors (lines 38-43):**
   - `text-emerald-900 dark:text-emerald-100` (title, line 38) -> `text-foreground`
   - `text-emerald-700 dark:text-emerald-300` (subtitle, line 42) -> `text-primary`
  </action>
  <verify>
Run `pnpm build` -- no TypeScript errors. Run `pnpm lint` -- no lint errors.
  </verify>
  <done>
Habit checklist celebration uses primary-based gradient. Absence card success state uses bg-highlight/text-primary while variant colors (amber/blue/orange) are preserved unchanged. Weekly insight card retains its blue information styling. Milestone card uses primary-based gradient. No hardcoded emerald/teal/slate remains in these files (except semantic colors explicitly kept).
  </done>
</task>

<task type="auto">
  <name>Task 2: Migrate tasks-today, habit-row, and update test assertions</name>
  <files>
    components/dashboard/tasks-today.tsx
    components/habits/habit-row.tsx
    tests/components/dashboard/tasks-today.test.tsx
  </files>
  <action>
In `components/dashboard/tasks-today.tsx`:

1. **Migrate TaskRow hover state (line 98):**
   - `hover:bg-slate-50 dark:hover:bg-slate-800` -> `hover:bg-accent`

2. **Migrate TaskRow checkbox checked state (line 103):**
   - `data-[state=checked]:bg-emerald-500 data-[state=checked]:border-emerald-500`
   -> `data-[state=checked]:bg-primary data-[state=checked]:border-primary`

3. **Migrate priority color for "none" (lines 72 and 321):**
   - `text-slate-400` -> `text-muted-foreground` (in both the TaskRow priorityColors object at line 72 AND the tomorrow tasks inline object at line 321)
   - Keep `text-green-500` (low), `text-yellow-500` (medium), `text-red-500` (high) -- these are semantic priority colors per research recommendation.

4. **Migrate "all complete" text (line 293):**
   - `text-emerald-600 dark:text-emerald-400` -> `text-primary`

In `components/habits/habit-row.tsx`:

1. **Migrate hover state (line 33):**
   - `hover:bg-slate-50 dark:hover:bg-slate-800` -> `hover:bg-accent`

2. **Migrate checkbox checked state (line 39):**
   - `data-[state=checked]:bg-emerald-500 data-[state=checked]:border-emerald-500`
   -> `data-[state=checked]:bg-primary data-[state=checked]:border-primary`

3. **Keep category color** (getCategoryColor on line 19) -- per research, leave getCategoryColor() for Phase 6 since it's a shared utility used across habits pages.

In `tests/components/dashboard/tasks-today.test.tsx`:

1. **Update priority color assertions:**
   - Line 361: change `text-slate-400` to `text-muted-foreground`
   - Line 802: change `text-slate-400` to `text-muted-foreground`

2. **Run full dashboard test suite to verify no other assertions break.**
  </action>
  <verify>
Run `pnpm test:run -- tests/components/dashboard/` -- all dashboard tests pass. Run `pnpm build` -- no errors. Run `pnpm lint` -- no lint errors. Run `pnpm test:run` for full test suite (verify no regressions).
  </verify>
  <done>
TaskRow and HabitRow use hover:bg-accent. All checkbox checked states use bg-primary/border-primary. Priority "none" color uses text-muted-foreground. "All complete" text uses text-primary. All dashboard tests pass. No hardcoded slate hover or emerald checkbox colors remain in tasks-today.tsx or habit-row.tsx. Full test suite passes.
  </done>
</task>

</tasks>

<verification>
After both tasks complete:
1. `pnpm build` passes with zero errors
2. `pnpm lint` passes with zero errors
3. `pnpm test:run` -- full test suite passes (including all dashboard tests)
4. Grep verification: No remaining `emerald-50|emerald-100|emerald-200|emerald-500|emerald-600|emerald-700|emerald-800|emerald-900|emerald-950|teal-50|teal-950` in any of the 6 modified component files (only allowed in weekly-insight-card.tsx which keeps blue, and variance config in absence-card.tsx which keeps amber/blue/orange)
5. Grep verification: No remaining `slate-200|slate-400|slate-500|slate-700|slate-800|slate-900` in `tasks-today.tsx`, `habit-row.tsx` (slate-400 may remain in priority colors for "none" -- should be migrated to text-muted-foreground)
</verification>

<success_criteria>
- Habit checklist "perfect day" celebration uses primary-based gradient (from-primary/5 to-primary/10)
- Absence card success state uses bg-highlight and text-primary; variant colors (amber/blue/orange) preserved
- Weekly insight card keeps distinct blue/indigo information styling unchanged per locked decision
- Milestone card uses primary-based gradient per locked decision
- HabitRow and TaskRow hover states use hover:bg-accent (design token)
- All checkbox checked states use bg-primary/border-primary
- Priority "none" color uses text-muted-foreground; other priorities (green/yellow/red) kept as semantic
- "All tasks complete" text uses text-primary
- All dashboard tests pass with updated assertions
- Full test suite has no regressions
</success_criteria>

<output>
After completion, create `.planning/phases/05-dashboard-page-migration/05-02-SUMMARY.md`
</output>
