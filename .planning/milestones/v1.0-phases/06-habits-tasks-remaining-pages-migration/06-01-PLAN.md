---
phase: 06-habits-tasks-remaining-pages-migration
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - components/layouts/page-breadcrumbs.tsx
  - components/habits/habit-form.tsx
  - components/tasks/task-form.tsx
  - i18n/messages/en.json
  - i18n/messages/zh.json
  - i18n/messages/zh-TW.json
autonomous: true
requirements:
  - VISL-08

must_haves:
  truths:
    - "PageBreadcrumbs renders a section link and optional item name using shadcn Breadcrumb primitives"
    - "Breadcrumbs show 2-level hierarchy: Section > Item name with ChevronRight separator"
    - "Long item names truncate on mobile (max-w-[200px]) and show full on sm+"
    - "HabitForm and TaskForm accept hideChrome prop to suppress internal title and buttons"
    - "HabitForm and TaskForm accept id prop to set form element id for external submit buttons"
    - "Breadcrumb labels are translated in all 3 locales (en, zh, zh-TW)"
  artifacts:
    - path: "components/layouts/page-breadcrumbs.tsx"
      provides: "Reusable breadcrumb component for nested views"
      contains: "PageBreadcrumbs"
    - path: "components/habits/habit-form.tsx"
      provides: "HabitForm with hideChrome and id props"
      contains: "hideChrome"
    - path: "components/tasks/task-form.tsx"
      provides: "TaskForm with hideChrome and id props"
      contains: "hideChrome"
  key_links:
    - from: "components/layouts/page-breadcrumbs.tsx"
      to: "components/ui/breadcrumb.tsx"
      via: "imports Breadcrumb primitives"
      pattern: "from.*@/components/ui/breadcrumb"
    - from: "components/layouts/page-breadcrumbs.tsx"
      to: "i18n/messages/en.json"
      via: "useTranslations('common.nav')"
      pattern: "useTranslations.*common.nav"
---

<objective>
Create the PageBreadcrumbs component and prepare HabitForm/TaskForm for the new layout by adding hideChrome and id props.

Purpose: These shared components are prerequisites for plans 06-02 and 06-03. PageBreadcrumbs wraps shadcn Breadcrumb primitives for consistent breadcrumb navigation on nested views. The form hideChrome/id props enable moving Save/Cancel buttons to PageHeader while keeping form submission working.

Output: PageBreadcrumbs component, updated HabitForm/TaskForm with backward-compatible new props, i18n strings for breadcrumbs.
</objective>

<execution_context>
@/home/xingdi/.claude/get-shit-done/workflows/execute-plan.md
@/home/xingdi/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/06-habits-tasks-remaining-pages-migration/06-RESEARCH.md
@components/ui/breadcrumb.tsx
@components/layouts/page-header.tsx
@components/habits/habit-form.tsx
@components/tasks/task-form.tsx
@i18n/messages/en.json
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create PageBreadcrumbs component and add i18n strings</name>
  <files>
    components/layouts/page-breadcrumbs.tsx
    i18n/messages/en.json
    i18n/messages/zh.json
    i18n/messages/zh-TW.json
  </files>
  <action>
Create `components/layouts/page-breadcrumbs.tsx` as a "use client" component wrapping shadcn Breadcrumb primitives:

```tsx
"use client";

import Link from "next/link";
import { useTranslations } from "next-intl";
import {
  Breadcrumb, BreadcrumbList, BreadcrumbItem,
  BreadcrumbLink, BreadcrumbSeparator, BreadcrumbPage,
} from "@/components/ui/breadcrumb";
import { cn } from "@/lib/utils";

type Section = "habits" | "tasks" | "settings";

const SECTION_HREFS: Record<Section, string> = {
  habits: "/habits",
  tasks: "/tasks",
  settings: "/dashboard/settings",
};

interface PageBreadcrumbsProps {
  section: Section;
  itemName?: string;
  className?: string;
}

export function PageBreadcrumbs({ section, itemName, className }: PageBreadcrumbsProps) {
  const t = useTranslations("common.nav");

  return (
    <Breadcrumb className={cn("mb-2", className)}>
      <BreadcrumbList className="text-xs sm:text-sm">
        <BreadcrumbItem>
          <BreadcrumbLink asChild>
            <Link href={SECTION_HREFS[section]}>{t(section)}</Link>
          </BreadcrumbLink>
        </BreadcrumbItem>
        {itemName && (
          <>
            <BreadcrumbSeparator />
            <BreadcrumbItem>
              <BreadcrumbPage className="truncate max-w-[200px] sm:max-w-none">
                {itemName}
              </BreadcrumbPage>
            </BreadcrumbItem>
          </>
        )}
      </BreadcrumbList>
    </Breadcrumb>
  );
}
```

Key decisions (Claude's discretion):
- Breadcrumbs only on nested views (detail, edit, create), NOT on top-level list pages. Top-level pages use sidebar active state for location.
- `text-xs sm:text-sm` for breadcrumb text -- visually subordinate to page title.
- `truncate max-w-[200px] sm:max-w-none` for mobile truncation of long item names.
- Default ChevronRight separator from shadcn BreadcrumbSeparator.
- `mb-2` default spacing between breadcrumbs and PageHeader below.

Add breadcrumb-related i18n strings to all 3 locale files. The breadcrumb section labels use existing `common.nav.habits`, `common.nav.tasks`, `common.nav.settings` keys (already present). Add new keys for create page breadcrumb items:

In `i18n/messages/en.json`, add under `habits.breadcrumb`:
```json
"breadcrumb": {
  "newHabit": "New Habit"
}
```

In `habits` section and similarly in `tasks`:
```json
"breadcrumb": {
  "newTask": "New Task"
}
```

Add equivalent translations in zh.json and zh-TW.json:
- zh: habits.breadcrumb.newHabit = "新习惯", tasks.breadcrumb.newTask = "新任务"
- zh-TW: habits.breadcrumb.newHabit = "新習慣", tasks.breadcrumb.newTask = "新任務"
  </action>
  <verify>
Run `pnpm lint` to verify no TypeScript errors. Check that the breadcrumb component imports resolve correctly and i18n JSON files are valid.
  </verify>
  <done>
PageBreadcrumbs component exists at `components/layouts/page-breadcrumbs.tsx` with section prop, optional itemName, mobile truncation, and proper i18n. All 3 locale files have breadcrumb strings for habits and tasks.
  </done>
</task>

<task type="auto">
  <name>Task 2: Add hideChrome and id props to HabitForm and TaskForm</name>
  <files>
    components/habits/habit-form.tsx
    components/tasks/task-form.tsx
  </files>
  <action>
Update both HabitForm and TaskForm to accept two new backward-compatible props:

1. `hideChrome?: boolean` (default false) -- when true, suppresses the internal `<h2>` title and the save/cancel button row at the bottom of the form. This allows the parent component (create/edit content) to render these in the PageHeader instead.

2. `id?: string` -- sets the `id` attribute on the `<form>` element. This enables external submit buttons to use `form="habit-form"` / `form="task-form"` attribute to trigger form submission from outside the form element (e.g., from PageHeader actions slot).

In `components/habits/habit-form.tsx`:
- Add `hideChrome?: boolean` and `id?: string` to `HabitFormProps` interface
- Wrap the `<h2>` title in `{!hideChrome && ...}`
- Wrap the save/cancel button `<div>` in `{!hideChrome && ...}`
- Add `id={id}` to the `<form>` element
- Also migrate the submit button from `className="bg-emerald-500 hover:bg-emerald-600 text-white"` to no custom className (use default Button primary styling which inherits from design tokens). This addresses the hardcoded emerald color audit from Phase 1.

In `components/tasks/task-form.tsx`:
- Same changes as HabitForm: `hideChrome`, `id` props, conditional rendering, form id
- Same emerald button migration as HabitForm

Both form components remain fully backward compatible -- existing usage without hideChrome/id props works identically (hideChrome defaults to false, id defaults to undefined).
  </action>
  <verify>
Run `pnpm test:run -- --reporter verbose tests/components/habits/habit-form.test.tsx tests/components/tasks/task-form.test.tsx` to verify existing form tests still pass. Run `pnpm lint` for type checking.
  </verify>
  <done>
HabitForm and TaskForm accept hideChrome and id props. When hideChrome is false (default), forms render identically to before. When hideChrome is true, internal title and buttons are hidden, and the form element has the provided id for external button association. Hardcoded emerald-500 submit button colors are migrated to default Button styling.
  </done>
</task>

</tasks>

<verification>
1. `pnpm lint` passes -- no TypeScript errors from new component or modified form props
2. `pnpm test:run -- tests/components/habits/habit-form.test.tsx` passes -- existing tests unaffected by new props
3. `pnpm test:run -- tests/components/tasks/task-form.test.tsx` passes -- existing tests unaffected by new props
4. All 3 locale JSON files are valid JSON with breadcrumb keys
</verification>

<success_criteria>
- PageBreadcrumbs component renders section link + optional item name with proper i18n
- HabitForm and TaskForm have hideChrome/id props without breaking existing behavior
- All lint and existing tests pass
</success_criteria>

<output>
After completion, create `.planning/phases/06-habits-tasks-remaining-pages-migration/06-01-SUMMARY.md`
</output>
