---
phase: 04-page-header-content-layout
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - app/globals.css
  - tailwind.config.ts
  - components/layouts/page-header.tsx
  - components/layouts/sidebar-layout.tsx
autonomous: true
requirements: [VISL-03, VISL-04, VISL-05]

must_haves:
  truths:
    - "Page title font size renders at 24px (not 28px) matching Chameleon's h1"
    - "Content area has gray canvas background (bg-page) instead of white"
    - "Content area centers horizontally with max-width 1400px on ultra-wide screens"
    - "Desktop page padding is 32px horizontal and 40px top, matching Chameleon"
    - "PageHeader component renders title on left and optional actions on right"
    - "PageHeader stacks vertically on mobile (title on top, actions below)"
    - "Section gaps use 16px (space-y-4) matching Chameleon's vertical rhythm"
  artifacts:
    - path: "components/layouts/page-header.tsx"
      provides: "Reusable page header with title, subtitle, actions"
      exports: ["PageHeader", "PageHeaderSkeleton"]
    - path: "components/layouts/sidebar-layout.tsx"
      provides: "Updated content wrapper with bg-page, max-width, responsive padding"
      contains: "max-w-[1400px]"
    - path: "app/globals.css"
      provides: "Corrected token values for page-title and card-gap"
      contains: "--font-size-page-title: 1.5rem"
    - path: "tailwind.config.ts"
      provides: "Updated text-page-title with correct lineHeight and letterSpacing"
      contains: "letterSpacing"
  key_links:
    - from: "components/layouts/page-header.tsx"
      to: "tailwind.config.ts"
      via: "text-page-title Tailwind utility class"
      pattern: "text-page-title"
    - from: "components/layouts/sidebar-layout.tsx"
      to: "app/globals.css"
      via: "bg-page Tailwind utility referencing --page CSS variable"
      pattern: "bg-page"
---

<objective>
Correct Phase 1 design tokens to match Playwright-verified Chameleon values, create the PageHeader reusable component, and update the SidebarLayout content wrapper with Chameleon-matching padding, gray canvas background, and max-width centering.

Purpose: Establish the layout primitives (PageHeader + content wrapper) that every authenticated page will use, ensuring pixel-perfect match with Chameleon's dashboard spacing, typography, and content width behavior.
Output: Updated globals.css tokens, updated tailwind.config.ts, new PageHeader component, updated SidebarLayout content wrapper.
</objective>

<execution_context>
@/home/xingdi/.claude/get-shit-done/workflows/execute-plan.md
@/home/xingdi/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/04-page-header-content-layout/04-RESEARCH.md
@.planning/phases/01-design-token-extraction-css-foundation/01-01-SUMMARY.md
@.planning/phases/01-design-token-extraction-css-foundation/01-02-SUMMARY.md
@app/globals.css
@tailwind.config.ts
@components/layouts/sidebar-layout.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Correct design tokens and Tailwind config to match Chameleon measurements</name>
  <files>app/globals.css, tailwind.config.ts</files>
  <action>
Update globals.css token values based on Playwright-verified Chameleon measurements:

1. In `:root` section:
   - Change `--font-size-page-title: 1.75rem` to `--font-size-page-title: 1.5rem` (Chameleon h1 = 24px, not 28px)
   - Change `--spacing-card-gap: 1.5rem` to `--spacing-card-gap: 1rem` (Chameleon uses 16px between sections, not 24px)
   - Add `--spacing-page-padding-top: 2.5rem;` after `--spacing-page-padding` (Chameleon's 40px top padding)
   - Add `--content-max-width: 1400px;` in a new `/* === Content layout === */` section after the Layout section (for ultra-wide centering)

2. In `.dark` section:
   - Mirror any token additions (--spacing-page-padding-top and --content-max-width use the same values in dark mode, but add them for completeness if the dark section has spacing/layout tokens; otherwise skip since these are theme-independent values)

3. In tailwind.config.ts, update the `fontSize` > `"page-title"` entry:
   - Change `{ lineHeight: "1.2", fontWeight: "700" }` to `{ lineHeight: "1.33", fontWeight: "700", letterSpacing: "-0.025em" }`
   - This matches Chameleon: 32px line-height / 24px font-size = 1.333, and -0.6px / 24px ≈ -0.025em

4. In tailwind.config.ts, add `"page-padding-top"` to the `spacing` extension:
   - `"page-padding-top": "var(--spacing-page-padding-top)"`

5. In tailwind.config.ts, add `"content-max-width"` to a new `maxWidth` extension:
   - `maxWidth: { content: "var(--content-max-width)" }`

Do NOT change any other token values. The --spacing-card-padding (1.5rem/24px) and --spacing-page-padding (2rem/32px) are already correct per research.
  </action>
  <verify>
Run `pnpm build` to confirm no CSS/config errors. Grep globals.css for `--font-size-page-title: 1.5rem` and `--spacing-card-gap: 1rem` to confirm values updated. Grep tailwind.config.ts for `letterSpacing` to confirm page-title update.
  </verify>
  <done>
Token values match Chameleon measurements: page-title at 1.5rem (24px), card-gap at 1rem (16px), page-padding-top at 2.5rem (40px), content-max-width at 1400px. Tailwind text-page-title utility includes lineHeight 1.33 and letterSpacing -0.025em.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create PageHeader component and update SidebarLayout content wrapper</name>
  <files>components/layouts/page-header.tsx, components/layouts/sidebar-layout.tsx</files>
  <action>
**Part A: Create `components/layouts/page-header.tsx`**

Create a new file with two exports: `PageHeader` and `PageHeaderSkeleton`.

PageHeader component:
- Props interface: `{ title: string; subtitle?: string; actions?: React.ReactNode; className?: string }`
- Layout: `flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between` (stacks on mobile, row on sm+)
- Title area (left): `min-w-0 flex-1` wrapper with:
  - `<h1 className="text-page-title tracking-tight">{title}</h1>` (uses Phase 1 text-page-title which now includes 24px/700/1.33/tight-tracking)
  - Optional subtitle: `<p className="mt-1 text-section-heading text-muted-foreground">{subtitle}</p>` (18px/600/muted per Chameleon)
- Actions area (right): `flex items-center gap-2 shrink-0` wrapper, only rendered if `actions` prop is provided
- Accept `className` prop merged via `cn()` utility from `@/lib/utils`
- This is NOT a client component -- no "use client" directive needed (it's a pure presentational component)

PageHeaderSkeleton component:
- Props: `{ hasSubtitle?: boolean; hasActions?: boolean }`
- Import `Skeleton` from `@/components/ui/skeleton`
- Same flex layout as PageHeader
- Title skeleton: `<Skeleton className="h-8 w-48" />`
- Subtitle skeleton (if hasSubtitle): `<Skeleton className="h-5 w-64" />`
- Actions skeleton (if hasActions): `<Skeleton className="h-9 w-32" />`

**Part B: Update `components/layouts/sidebar-layout.tsx`**

In the SidebarLayout component, change the content wrapper (currently `<div className="flex-1 p-4 md:p-6">{children}</div>`) to:

```tsx
<div className="flex-1 overflow-auto bg-page">
  <div className="mx-auto w-full max-w-content px-4 py-6 sm:px-6 md:px-8 md:pt-10">
    {children}
  </div>
</div>
```

Key changes:
- Outer div: `flex-1 overflow-auto bg-page` (gray canvas background, scrollable)
- Inner div: `mx-auto w-full max-w-content px-4 py-6 sm:px-6 md:px-8 md:pt-10` for responsive padding and ultra-wide centering
- Mobile: 16px horizontal padding, 24px vertical padding
- Tablet (sm): 24px horizontal padding
- Desktop (md): 32px horizontal, 40px top padding
- Ultra-wide: max-width 1400px with auto horizontal margins

Note: Use `max-w-content` (registered in Task 1) NOT `max-w-[1400px]` since we added the token.
  </action>
  <verify>
Run `pnpm build` to confirm no TypeScript errors. Verify `components/layouts/page-header.tsx` exports both PageHeader and PageHeaderSkeleton. Verify sidebar-layout.tsx contains `bg-page` and `max-w-content`.
  </verify>
  <done>
PageHeader component exists with title/subtitle/actions props and mobile-first responsive layout. PageHeaderSkeleton provides loading state. SidebarLayout content wrapper uses bg-page (gray canvas), max-w-content (1400px centering), and Chameleon-matching responsive padding (16px mobile → 32px/40px desktop).
  </done>
</task>

<task type="auto">
  <name>Task 3: Add PageHeader unit test and verify full test suite</name>
  <files>tests/components/layouts/page-header.test.tsx</files>
  <action>
Create `tests/components/layouts/page-header.test.tsx` with the following test cases:

1. **renders title as h1** -- Render PageHeader with title="Test Title", assert `getByRole("heading", { level: 1 })` has text "Test Title"
2. **renders subtitle when provided** -- Render with title + subtitle="Sub text", assert subtitle text is present in the document
3. **does not render subtitle when omitted** -- Render with only title, assert no paragraph with subtitle text
4. **renders actions when provided** -- Render with actions={<button>Click</button>}, assert button is in the document
5. **does not render actions container when omitted** -- Render with only title, assert no button element exists
6. **applies custom className** -- Render with className="custom-class", assert the root element contains "custom-class"
7. **has no accessibility violations** -- Render PageHeader with title, run `axe()` and assert `toHaveNoViolations()`

Mock pattern: Use the standard project test setup. Mock `next-intl` if needed (PageHeader doesn't use translations directly, so likely no mock needed).

Import pattern:
```tsx
import { render, screen } from "@testing-library/react";
import { axe } from "vitest-axe";
import { PageHeader } from "@/components/layouts/page-header";
```

After writing the test, run:
1. `pnpm test:run -- tests/components/layouts/page-header.test.tsx` to verify tests pass
2. `pnpm lint` to verify no lint errors across all modified files
3. `pnpm build` to verify production build succeeds
4. `pnpm test:run` to verify full test suite still passes (no regressions)
  </action>
  <verify>
All PageHeader tests pass. `pnpm lint` passes. `pnpm build` succeeds. `pnpm test:run` shows all tests passing (expect 2 known failures in habit-logs.test.ts per issue #98).
  </verify>
  <done>
PageHeader has 7+ unit tests covering rendering, optional props, accessibility. Full test suite passes. Build and lint clean.
  </done>
</task>

</tasks>

<verification>
1. `grep -q "1.5rem" app/globals.css` -- page-title token updated to 24px
2. `grep -q "letterSpacing" tailwind.config.ts` -- tracking added to page-title utility
3. `grep -q "1rem" app/globals.css` -- card-gap token updated to 16px
4. File exists: `components/layouts/page-header.tsx`
5. `grep -q "bg-page" components/layouts/sidebar-layout.tsx` -- gray canvas background applied
6. `grep -q "max-w-content" components/layouts/sidebar-layout.tsx` -- max-width centering applied
7. `pnpm build` succeeds
8. `pnpm lint` passes
9. `pnpm test:run` passes (minus known failures)
</verification>

<success_criteria>
- Design tokens corrected: --font-size-page-title is 1.5rem (24px), --spacing-card-gap is 1rem (16px)
- Tailwind text-page-title utility includes lineHeight 1.33 and letterSpacing -0.025em
- PageHeader component exists with title (required), subtitle (optional), actions (optional) props
- PageHeader stacks vertically on mobile, horizontally on sm+ breakpoint
- PageHeaderSkeleton exists for loading states
- SidebarLayout content wrapper uses bg-page, responsive padding (px-4→px-8, py-6→pt-10), max-w-content (1400px)
- All existing tests pass, new PageHeader tests pass
- Build and lint clean
</success_criteria>

<output>
After completion, create `.planning/phases/04-page-header-content-layout/04-01-SUMMARY.md`
</output>
