---
phase: 15-kanban-board
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - package.json
  - components/projects/project-card.tsx
  - app/api/tasks/route.ts
  - lib/db/tasks.ts
  - app/projects/[id]/kanban/page.tsx
  - app/projects/[id]/kanban/layout.tsx
  - components/kanban/kanban-skeleton.tsx
  - i18n/messages/en.json
  - i18n/messages/zh.json
  - i18n/messages/zh-TW.json
autonomous: true
requirements: [PAGE-03, I18N-01]

must_haves:
  truths:
    - "GET /api/tasks?project_id={id} returns only tasks belonging to that project"
    - "Clicking a project card navigates to /projects/[id]/kanban"
    - "The kanban page route exists and renders (shows loading skeleton while board loads)"
    - "All kanban i18n strings exist in en, zh, and zh-TW locale files"
  artifacts:
    - path: "app/projects/[id]/kanban/page.tsx"
      provides: "Server page with auth check and dynamic import of KanbanBoard"
    - path: "app/projects/[id]/kanban/layout.tsx"
      provides: "SidebarShell layout wrapper"
    - path: "components/kanban/kanban-skeleton.tsx"
      provides: "Loading skeleton for SSR-disabled board"
    - path: "i18n/messages/en.json"
      provides: "kanban namespace with all board UI strings"
  key_links:
    - from: "components/projects/project-card.tsx"
      to: "app/projects/[id]/kanban/page.tsx"
      via: "router.push(/projects/{id}/kanban)"
      pattern: "router\\.push.*kanban"
    - from: "app/api/tasks/route.ts"
      to: "lib/db/tasks.ts"
      via: "project_id filter in getUserTasks"
      pattern: "project_id"
---

<objective>
Install @dnd-kit dependencies, close the API gap (project_id filtering), set up the kanban page route, update ProjectCard navigation, and add all i18n strings.

Purpose: Provide the foundation that the kanban board UI (Plan 02) needs — installed DnD library, API endpoint for project-scoped tasks, page route, and translated strings.
Output: Working kanban page route (shows skeleton), project-scoped task API, all i18n keys.
</objective>

<execution_context>
@/home/xingdi/.claude/get-shit-done/workflows/execute-plan.md
@/home/xingdi/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/15-kanban-board/15-CONTEXT.md
@.planning/phases/15-kanban-board/15-RESEARCH.md
@.planning/phases/14-projects-sections/14-03-SUMMARY.md
@app/api/tasks/route.ts
@lib/db/tasks.ts
@lib/db/types.ts
@components/projects/project-card.tsx
@components/layouts/sidebar-shell.tsx
@i18n/messages/en.json
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install @dnd-kit, add project_id API filter, update ProjectCard route</name>
  <files>
    package.json
    app/api/tasks/route.ts
    lib/db/tasks.ts
    components/projects/project-card.tsx
  </files>
  <action>
1. **Install @dnd-kit packages:**
   ```bash
   pnpm add @dnd-kit/core @dnd-kit/utilities
   ```

2. **Add peerDependencyRules for React 19** in `package.json` under `"pnpm"` key (create if absent):
   ```json
   "pnpm": {
     "peerDependencyRules": {
       "allowedVersions": {
         "@dnd-kit/core>react": "19",
         "@dnd-kit/core>react-dom": "19",
         "@dnd-kit/utilities>react": "19"
       }
     }
   }
   ```

3. **Add project_id filter to `lib/db/tasks.ts` `getUserTasks()`:**
   In the `getUserTasks` method, after existing filters, add:
   ```typescript
   if (filters.project_id !== undefined) {
     if (filters.project_id === null) {
       query = query.is('project_id', null);
     } else {
       query = query.eq('project_id', filters.project_id);
     }
   }
   ```
   Also check that `TaskFilters` in `lib/db/types.ts` already has `project_id?: string | null` — it should from Phase 14.

4. **Add project_id query param to `app/api/tasks/route.ts` GET handler:**
   After the existing `has_due_date` filter block (around line 104), add:
   ```typescript
   if (searchParams.has('project_id')) {
     const projectId = searchParams.get('project_id')!;
     filters.project_id = projectId === 'null' ? null : projectId;
   }
   ```

5. **Update ProjectCard route from `/board` to `/kanban`** per CONTEXT locked decision:
   In `components/projects/project-card.tsx`, change both route references:
   - Line 79: `router.push(\`/projects/${project.id}/board\`)` → `router.push(\`/projects/${project.id}/kanban\`)`
   - Line 192: `router.push(\`/projects/${project.id}/board\`)` → `router.push(\`/projects/${project.id}/kanban\`)`
  </action>
  <verify>
    - `pnpm list @dnd-kit/core` shows installed version
    - `pnpm build` succeeds (or at least no TypeScript errors from the changes)
    - `pnpm test:run -- tests/app/api/tasks/route.test.ts` passes (existing tests should still pass)
    - `grep -r "kanban" components/projects/project-card.tsx` shows updated route
  </verify>
  <done>
    - @dnd-kit/core and @dnd-kit/utilities installed with React 19 peer dep rules
    - GET /api/tasks accepts project_id query param and filters tasks
    - ProjectCard navigates to /projects/[id]/kanban instead of /projects/[id]/board
  </done>
</task>

<task type="auto">
  <name>Task 2: Create kanban page route, skeleton, and i18n strings</name>
  <files>
    app/projects/[id]/kanban/page.tsx
    app/projects/[id]/kanban/layout.tsx
    components/kanban/kanban-skeleton.tsx
    i18n/messages/en.json
    i18n/messages/zh.json
    i18n/messages/zh-TW.json
  </files>
  <action>
1. **Create `components/kanban/kanban-skeleton.tsx`** — loading skeleton shown while board loads:
   ```typescript
   export function KanbanSkeleton() {
     // 4-column skeleton with header bar + 3 card placeholders per column
     // Use shadcn Skeleton component: rounded rectangles mimicking column headers + card shapes
     // Layout: flex gap-4, each column w-72 min-w-72 with bg-muted/30 rounded-lg
   }
   ```

2. **Create `app/projects/[id]/kanban/layout.tsx`** — wraps with SidebarShell:
   ```typescript
   import { SidebarShell } from "@/components/layouts/sidebar-shell";
   export default async function KanbanLayout({ children }: { children: React.ReactNode }) {
     return <SidebarShell>{children}</SidebarShell>;
   }
   ```

3. **Create `app/projects/[id]/kanban/page.tsx`** — server page with auth + dynamic import:
   ```typescript
   import dynamic from "next/dynamic";
   import { createClient } from "@/lib/supabase/server";
   import { redirect } from "next/navigation";
   import { KanbanSkeleton } from "@/components/kanban/kanban-skeleton";

   const KanbanBoard = dynamic(
     () => import("@/components/kanban/kanban-board").then(m => m.KanbanBoard),
     { ssr: false, loading: () => <KanbanSkeleton /> }
   );

   export default async function KanbanPage({ params }: { params: Promise<{ id: string }> }) {
     const { id } = await params;
     const supabase = await createClient();
     const { data: { user } } = await supabase.auth.getUser();
     if (!user) redirect("/auth/login");
     return <KanbanBoard projectId={id} />;
   }
   ```
   Note: The dynamic import targets `@/components/kanban/kanban-board` which will be created in Plan 02. For now, the page will render the skeleton (since the module doesn't exist yet). This is fine — the page route and layout are the deliverable for this plan.

4. **Add kanban i18n strings to all 3 locale files.** Add a top-level `"kanban"` namespace with these keys:

   **en.json:**
   ```json
   "kanban": {
     "backToTasks": "Back to Tasks",
     "taskCount": "{count, plural, =0 {No tasks} =1 {1 task} other {# tasks}}",
     "columns": {
       "backlog": "Backlog",
       "todo": "To Do",
       "in_progress": "In Progress",
       "done": "Done"
     },
     "emptyColumn": "No tasks in this column",
     "quickAdd": {
       "placeholder": "Add a task..."
     },
     "dragError": "Failed to update task status",
     "createError": "Failed to create task",
     "detail": {
       "detailsTab": "Details",
       "activityTab": "Activity",
       "status": "Status",
       "priority": "Priority",
       "section": "Section",
       "project": "Project",
       "dueDate": "Due Date",
       "description": "Description",
       "noDescription": "No description",
       "noDueDate": "No due date",
       "commentsPlaceholder": "Comments and updates coming soon",
       "activityPlaceholder": "Activity log coming soon",
       "editTask": "Edit Task"
     },
     "priority": {
       "high": "High",
       "medium": "Medium",
       "low": "Low",
       "none": "None"
     }
   }
   ```

   **zh.json:** (Simplified Chinese translations)
   ```json
   "kanban": {
     "backToTasks": "返回任务",
     "taskCount": "{count, plural, =0 {没有任务} other {# 个任务}}",
     "columns": {
       "backlog": "待办池",
       "todo": "待办",
       "in_progress": "进行中",
       "done": "已完成"
     },
     "emptyColumn": "此列暂无任务",
     "quickAdd": {
       "placeholder": "添加任务..."
     },
     "dragError": "更新任务状态失败",
     "createError": "创建任务失败",
     "detail": {
       "detailsTab": "详情",
       "activityTab": "动态",
       "status": "状态",
       "priority": "优先级",
       "section": "分区",
       "project": "项目",
       "dueDate": "截止日期",
       "description": "描述",
       "noDescription": "暂无描述",
       "noDueDate": "暂无截止日期",
       "commentsPlaceholder": "评论和更新功能即将上线",
       "activityPlaceholder": "活动日志功能即将上线",
       "editTask": "编辑任务"
     },
     "priority": {
       "high": "高",
       "medium": "中",
       "low": "低",
       "none": "无"
     }
   }
   ```

   **zh-TW.json:** (Traditional Chinese translations)
   ```json
   "kanban": {
     "backToTasks": "返回任務",
     "taskCount": "{count, plural, =0 {沒有任務} other {# 個任務}}",
     "columns": {
       "backlog": "待辦池",
       "todo": "待辦",
       "in_progress": "進行中",
       "done": "已完成"
     },
     "emptyColumn": "此列暫無任務",
     "quickAdd": {
       "placeholder": "新增任務..."
     },
     "dragError": "更新任務狀態失敗",
     "createError": "建立任務失敗",
     "detail": {
       "detailsTab": "詳情",
       "activityTab": "動態",
       "status": "狀態",
       "priority": "優先順序",
       "section": "分區",
       "project": "專案",
       "dueDate": "截止日期",
       "description": "描述",
       "noDescription": "暫無描述",
       "noDueDate": "暫無截止日期",
       "commentsPlaceholder": "評論和更新功能即將上線",
       "activityPlaceholder": "活動日誌功能即將上線",
       "editTask": "編輯任務"
     },
     "priority": {
       "high": "高",
       "medium": "中",
       "low": "低",
       "none": "無"
     }
   }
   ```
  </action>
  <verify>
    - `ls app/projects/\[id\]/kanban/` shows page.tsx and layout.tsx
    - `ls components/kanban/kanban-skeleton.tsx` exists
    - `grep -c '"kanban"' i18n/messages/en.json i18n/messages/zh.json i18n/messages/zh-TW.json` shows 1 match per file
    - `pnpm lint` passes
  </verify>
  <done>
    - Kanban page route exists at /projects/[id]/kanban with auth check and SidebarShell layout
    - KanbanSkeleton renders a 4-column loading skeleton
    - All kanban UI strings translated in en, zh, and zh-TW
  </done>
</task>

</tasks>

<verification>
- `pnpm test:run` passes with no regressions
- `pnpm lint` passes
- Navigating to /projects/{id}/kanban shows the skeleton (board component pending Plan 02)
- GET /api/tasks?project_id={uuid} returns filtered tasks
</verification>

<success_criteria>
- @dnd-kit installed and importable
- project_id filtering works in API
- ProjectCard links to /projects/[id]/kanban
- Kanban page route renders with auth check
- All i18n kanban strings present in 3 locales
</success_criteria>

<output>
After completion, create `.planning/phases/15-kanban-board/15-01-SUMMARY.md`
</output>
