---
phase: 08-visual-polish
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - app/globals.css
  - components/footer.tsx
  - components/hero.tsx
  - components/navbar.tsx
  - components/habits/heatmap.tsx
  - components/habits/streak-counter.tsx
  - components/habits/habit-card.tsx
  - components/habits/habit-empty-state.tsx
  - components/habits/frequency-selector.tsx
  - components/habits/next-milestone.tsx
  - components/tasks/task-card.tsx
  - components/tasks/task-empty-state.tsx
  - components/tasks/task-detail-content.tsx
  - app/page.tsx
  - tests/components/habits/heatmap.test.tsx
autonomous: true
requirements:
  - VISL-06

must_haves:
  truths:
    - "Emerald/teal accent color is visibly desaturated in dark mode compared to light mode"
    - "All UI elements using the brand accent color respond to the dark mode desaturation (no bright emerald outliers)"
    - "Light mode accent color remains unchanged (vibrant emerald/teal)"
    - "Semantic colors (priority green/yellow/red, info blue/indigo, warning amber) are NOT altered"
  artifacts:
    - path: "app/globals.css"
      provides: "Desaturated dark mode primary and sidebar tokens"
      contains: "--primary: 160 45% 55%"
    - path: "components/habits/habit-card.tsx"
      provides: "Token-based accent colors instead of hardcoded emerald"
      contains: "bg-primary"
    - path: "components/tasks/task-card.tsx"
      provides: "Token-based accent colors instead of hardcoded emerald"
      contains: "bg-primary"
  key_links:
    - from: "app/globals.css (.dark --primary)"
      to: "All components using bg-primary/text-primary"
      via: "CSS custom property inheritance"
      pattern: "bg-primary|text-primary"
---

<objective>
Desaturate the emerald/teal accent color in dark mode and migrate all remaining hardcoded emerald/teal Tailwind classes to design tokens so the desaturation applies universally.

Purpose: The current dark mode primary (S=60%, L=50%) is barely distinguishable from light mode (S=63%, L=45%). Reducing saturation to ~45% and increasing lightness to ~55% creates a visibly muted, eye-comfortable accent in dark mode. However, 13+ component files still use hardcoded `emerald-*` and `teal-*` classes that bypass the design token system entirely -- these must be migrated or the desaturation won't apply to them.

Output: Updated `globals.css` dark mode tokens + all component files using `bg-primary`/`text-primary` tokens instead of hardcoded emerald/teal classes.
</objective>

<execution_context>
@/home/xingdi/.claude/get-shit-done/workflows/execute-plan.md
@/home/xingdi/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/08-visual-polish/08-RESEARCH.md
@app/globals.css
</context>

<tasks>

<task type="auto">
  <name>Task 1: Desaturate dark mode accent tokens in globals.css</name>
  <files>app/globals.css</files>
  <action>
In `app/globals.css`, update the `.dark` section to desaturate the primary accent color and all matching sidebar tokens:

1. Change `--primary: 160 60% 50%` to `--primary: 160 45% 55%` (reduce saturation 15%, increase lightness 5%)
2. Change `--ring: 160 60% 50%` to `--ring: 160 45% 55%`
3. Change `--sidebar-primary: 160 60% 50%` to `--sidebar-primary: 160 45% 55%`
4. Change `--sidebar-ring: 160 60% 50%` to `--sidebar-ring: 160 45% 55%`

Do NOT change:
- Any `:root` (light mode) values -- they stay at `157 63% 45%`
- `--primary-foreground` or `--sidebar-primary-foreground` (contrast text colors)
- Chart colors, highlight, or any other tokens

Add a CSS comment on the `--primary` line in `.dark`: `/* desaturated for eye comfort (light: 157 63% 45%) */`
  </action>
  <verify>
Run `pnpm lint` to verify no CSS syntax issues.
Run `grep -n "160 45% 55%" app/globals.css` to confirm exactly 4 occurrences (primary, ring, sidebar-primary, sidebar-ring).
Run `grep -n "160 60% 50%" app/globals.css` to confirm zero remaining occurrences.
  </verify>
  <done>
Dark mode `.dark` section has `--primary`, `--ring`, `--sidebar-primary`, and `--sidebar-ring` all set to `160 45% 55%`. Light mode values are unchanged.
  </done>
</task>

<task type="auto">
  <name>Task 2: Migrate hardcoded emerald/teal classes to design tokens across 14 component files + 1 test file</name>
  <files>
    components/footer.tsx
    components/hero.tsx
    components/navbar.tsx
    components/habits/heatmap.tsx
    components/habits/streak-counter.tsx
    components/habits/habit-card.tsx
    components/habits/habit-empty-state.tsx
    components/habits/frequency-selector.tsx
    components/habits/next-milestone.tsx
    components/tasks/task-card.tsx
    components/tasks/task-empty-state.tsx
    components/tasks/task-detail-content.tsx
    app/page.tsx
    tests/components/habits/heatmap.test.tsx
  </files>
  <action>
Migrate each file's hardcoded emerald/teal Tailwind classes to design token equivalents. Follow these replacement rules:

**Standard replacements (apply to all files):**
- `text-emerald-500` -> `text-primary`
- `text-emerald-600` -> `text-primary`
- `text-emerald-600 dark:text-emerald-400` -> `text-primary` (token auto-adapts to dark mode)
- `bg-emerald-500` -> `bg-primary`
- `bg-emerald-600` -> `bg-primary`
- `hover:bg-emerald-600` -> `hover:bg-primary/90`
- `hover:bg-emerald-700` -> `hover:bg-primary/90`
- `hover:text-emerald-600` -> `hover:text-primary`
- `bg-emerald-100` -> `bg-primary/10`
- `bg-emerald-50` -> `bg-primary/5`
- `text-emerald-100` -> `text-primary-foreground`
- `border-emerald-500` -> `border-primary`
- `border-l-emerald-500` -> `border-l-primary`
- `ring-emerald-500` -> `ring-primary`
- `data-[state=checked]:bg-emerald-500` -> `data-[state=checked]:bg-primary`
- `data-[state=checked]:border-emerald-500` -> `data-[state=checked]:border-primary`
- `data-[state=on]:bg-emerald-500` -> `data-[state=on]:bg-primary`
- `from-emerald-500` -> removed, use solid `bg-primary` instead
- `to-emerald-400` -> removed (gradient replaced with solid)

**File-specific guidance:**

`components/footer.tsx`: Replace all 16+ instances of `hover:text-emerald-600` with `hover:text-primary`.

`components/hero.tsx`:
- CTA button: `bg-emerald-600 hover:bg-emerald-700` -> `bg-primary hover:bg-primary/90`
- Text gradient `from-emerald-600 to-teal-500`: Replace with `text-primary` (drop gradient, use solid token color). Remove the `text-transparent bg-clip-text bg-gradient-to-r` classes.
- Second text gradient `from-teal-500 to-cyan-500`: Replace with `text-primary` similarly.
- Background gradient `from-emerald-50 via-background to-teal-50`: Replace with `from-primary/5 via-background to-primary/5`. Keep dark variants: `dark:from-primary/5 dark:to-primary/5` (replacing `dark:from-emerald-950/20 dark:to-teal-950/20`).

`components/navbar.tsx`: `text-emerald-600` -> `text-primary`.

`components/habits/heatmap.tsx`:
- `bg-emerald-500` -> `bg-primary`
- `ring-emerald-500` -> `ring-primary`
- Legend dot: `bg-emerald-500` -> `bg-primary`

`components/habits/streak-counter.tsx`: All 4 instances of `text-emerald-500` -> `text-primary`.

`components/habits/habit-card.tsx`:
- Checkbox: `data-[state=checked]:bg-emerald-500 data-[state=checked]:border-emerald-500` -> `data-[state=checked]:bg-primary data-[state=checked]:border-primary`
- Progress bar gradient: `bg-gradient-to-r from-emerald-500 to-emerald-400` -> `bg-primary` (solid, drop gradient)

`components/habits/habit-empty-state.tsx`:
- `text-emerald-500` -> `text-primary`
- `bg-emerald-100` -> `bg-primary/10`
- `bg-emerald-500 hover:bg-emerald-600` -> `bg-primary hover:bg-primary/90`

`components/habits/frequency-selector.tsx`:
- Active toggle: `bg-emerald-500 text-white hover:bg-emerald-600 hover:text-white data-[state=on]:bg-emerald-500 data-[state=on]:text-white` -> `bg-primary text-primary-foreground hover:bg-primary/90 hover:text-primary-foreground data-[state=on]:bg-primary data-[state=on]:text-primary-foreground`
- Apply same pattern to both weekday toggles and custom day toggles.

`components/habits/next-milestone.tsx`: `text-emerald-600 dark:text-emerald-400` -> `text-primary` (both instances).

`components/tasks/task-card.tsx`:
- `data-[state=checked]:bg-emerald-500 data-[state=checked]:border-emerald-500` -> `data-[state=checked]:bg-primary data-[state=checked]:border-primary`

`components/tasks/task-empty-state.tsx`:
- `text-emerald-500` -> `text-primary`
- `bg-emerald-100` -> `bg-primary/10`
- `bg-emerald-500 hover:bg-emerald-600` -> `bg-primary hover:bg-primary/90`

`components/tasks/task-detail-content.tsx`:
- `text-emerald-500` -> `text-primary` (for completed status icon)
- `bg-emerald-500` -> `bg-primary` (for completed badge)
- `border-l-emerald-500 bg-emerald-50 dark:bg-emerald-950/20` -> `border-l-primary bg-highlight` (completion callout box, highlight token already exists for this)
- `text-emerald-700 dark:text-emerald-400` -> `text-primary` (completion callout text)

`app/page.tsx`:
- Feature card icon: `text-emerald-600` -> `text-primary`
- Stats section: `bg-emerald-600` -> `bg-primary`
- Stats text: `text-emerald-100` -> `text-primary-foreground`
- CTA button: `bg-emerald-600 hover:bg-emerald-700` -> `bg-primary hover:bg-primary/90`

`tests/components/habits/heatmap.test.tsx`:
- `bg-emerald-500` -> `bg-primary` in assertions
- `ring-emerald-500` -> `ring-primary` in assertions

**DO NOT change:**
- `text-green-500` for priority indicators (semantic color, not brand accent)
- Blue/indigo colors (info/insight semantic)
- Amber/orange colors (warning semantic)
- Anything in `components/ui/` directory
  </action>
  <verify>
Run `pnpm lint` to verify no lint errors.
Run `pnpm test:run` to verify all tests pass.
Run a grep to confirm zero remaining `emerald-` or `teal-` outside of `components/ui/`, `node_modules/`, `.planning/`, and `docs/`: `grep -rn "emerald-\|teal-" --include="*.tsx" --include="*.ts" --exclude-dir=node_modules --exclude-dir=.planning --exclude-dir=docs components/ app/ tests/ | grep -v "components/ui/"` should return zero results.
  </verify>
  <done>
All 15 files migrated from hardcoded emerald/teal to design token classes. Zero remaining `emerald-*` or `teal-*` classes in component source files (excluding `components/ui/`). All existing tests pass. The dark mode desaturation now applies universally to every accent-colored element.
  </done>
</task>

</tasks>

<verification>
1. `pnpm lint` passes with zero errors
2. `pnpm test:run` passes (all existing tests)
3. `grep -rn "emerald-\|teal-" --include="*.tsx" --include="*.ts" --exclude-dir=node_modules --exclude-dir=.planning --exclude-dir=docs components/ app/ tests/ | grep -v "components/ui/"` returns zero results
4. `grep -c "160 45% 55%" app/globals.css` returns 4
5. `grep -c "160 60% 50%" app/globals.css` returns 0
</verification>

<success_criteria>
- Dark mode `--primary` token is `160 45% 55%` (visibly desaturated from light mode's `157 63% 45%`)
- All four dark mode accent tokens updated: `--primary`, `--ring`, `--sidebar-primary`, `--sidebar-ring`
- Zero hardcoded `emerald-*` or `teal-*` classes remain in component files (outside `components/ui/`)
- All tests pass, lint clean
- Semantic colors (green for priority, blue for info, amber for warning) are unchanged
</success_criteria>

<output>
After completion, create `.planning/phases/08-visual-polish/08-01-SUMMARY.md`
</output>
