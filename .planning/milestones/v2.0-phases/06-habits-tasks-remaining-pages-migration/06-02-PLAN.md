---
phase: 06-habits-tasks-remaining-pages-migration
plan: 02
type: execute
wave: 2
depends_on: ["06-01"]
files_modified:
  - components/habits/habits-page-content.tsx
  - components/habits/habit-detail-content.tsx
  - components/habits/create-habit-content.tsx
  - components/habits/edit-habit-content.tsx
  - tests/app/habits/habits-page-content.test.tsx
  - tests/app/habits/habit-detail-page.test.tsx
  - tests/components/habits/create-habit-content.test.tsx
  - tests/components/habits/edit-habit-content.test.tsx
autonomous: true
requirements:
  - VISL-10

must_haves:
  truths:
    - "Habits list page uses PageHeader with title and Create button in actions slot"
    - "Habit detail page shows breadcrumbs (Habits > habit name) above PageHeader"
    - "Habit detail page wraps all content in a single Card"
    - "Habit detail page has Edit button in PageHeader actions slot instead of separate header row"
    - "Habit create page shows breadcrumbs (Habits > New Habit) with form in Card"
    - "Habit edit page shows breadcrumbs (Habits > habit name) with form in Card"
    - "Create/edit pages have Save/Cancel in PageHeader actions slot using form attribute"
    - "Back button is removed from detail page (replaced by breadcrumbs)"
    - "All habit page tests pass after migration"
  artifacts:
    - path: "components/habits/habits-page-content.tsx"
      provides: "Habits list with PageHeader"
      contains: "PageHeader"
    - path: "components/habits/habit-detail-content.tsx"
      provides: "Habit detail with breadcrumbs, PageHeader, Card wrapping"
      contains: "PageBreadcrumbs"
    - path: "components/habits/create-habit-content.tsx"
      provides: "Create habit with breadcrumbs, PageHeader, Card-wrapped form"
      contains: "PageBreadcrumbs"
    - path: "components/habits/edit-habit-content.tsx"
      provides: "Edit habit with breadcrumbs, PageHeader, Card-wrapped form"
      contains: "PageBreadcrumbs"
  key_links:
    - from: "components/habits/habit-detail-content.tsx"
      to: "components/layouts/page-breadcrumbs.tsx"
      via: "breadcrumb navigation"
      pattern: "PageBreadcrumbs.*section.*habits"
    - from: "components/habits/create-habit-content.tsx"
      to: "components/habits/habit-form.tsx"
      via: "hideChrome and form id props"
      pattern: "hideChrome|form.*habit-form"
---

<objective>
Migrate all 4 habits pages (list, detail, create, edit) to the new card-on-gray layout with PageHeader and breadcrumbs.

Purpose: Habits pages are the first section to receive the full visual migration pattern. This establishes the pattern that tasks pages will follow in plan 06-03.

Output: All habits pages using PageHeader, breadcrumbs on nested views, Card wrapping on detail/form pages, updated tests.
</objective>

<execution_context>
@/home/xingdi/.claude/get-shit-done/workflows/execute-plan.md
@/home/xingdi/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/06-habits-tasks-remaining-pages-migration/06-RESEARCH.md
@.planning/phases/06-habits-tasks-remaining-pages-migration/06-01-SUMMARY.md
@components/habits/habits-page-content.tsx
@components/habits/habit-detail-content.tsx
@components/habits/create-habit-content.tsx
@components/habits/edit-habit-content.tsx
@components/habits/habit-form.tsx
@components/layouts/page-header.tsx
@components/layouts/page-breadcrumbs.tsx
@tests/app/habits/habits-page-content.test.tsx
@tests/app/habits/habit-detail-page.test.tsx
@tests/components/habits/create-habit-content.test.tsx
@tests/components/habits/edit-habit-content.test.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Migrate habits list and detail pages to PageHeader and breadcrumbs</name>
  <files>
    components/habits/habits-page-content.tsx
    components/habits/habit-detail-content.tsx
    tests/app/habits/habits-page-content.test.tsx
    tests/app/habits/habit-detail-page.test.tsx
  </files>
  <action>
**Habits list page (`habits-page-content.tsx`):**

Replace the inline header `<div className="flex items-center justify-between">` with PageHeader component:
```tsx
import { PageHeader } from "@/components/layouts/page-header";

// Replace inline h1 + button with:
<PageHeader
  title={t("page.title")}
  actions={
    <Button onClick={handleCreateHabit}>
      <Plus className="size-4 mr-2" />
      {t("page.createButton")}
    </Button>
  }
/>
```

Update the skeleton similarly -- replace the header skeleton div with `<PageHeaderSkeleton hasActions />` from page-header.tsx.

No breadcrumbs on list page (Claude's discretion: top-level pages don't need breadcrumbs). No Card wrapping (locked decision: individual cards float on gray). Keep the existing grid layout as-is.

**Habit detail page (`habit-detail-content.tsx`):**

Major changes:
1. Remove the ArrowLeft back button entirely -- breadcrumbs replace it
2. Add `PageBreadcrumbs section="habits" itemName={habit.name}` above PageHeader
3. Replace the inline header with PageHeader:
```tsx
<div>
  <PageBreadcrumbs section="habits" itemName={habit.name} />
  <PageHeader
    title={habit.name}
    actions={
      <Button onClick={() => router.push(`/habits/${habitId}/edit`)} className="gap-2">
        <Edit className="size-4" />
        {t("detail.edit")}
      </Button>
    }
  />
</div>
```
4. Wrap all content below the header (title/metadata, streak, milestone, stats, heatmap, actions) in a single Card:
```tsx
<Card className="max-w-3xl">
  <CardContent className="space-y-6 pt-6">
    {/* All existing content */}
  </CardContent>
</Card>
```
5. Remove the outer `max-w-3xl mx-auto` from the top-level div -- the Card itself has `max-w-3xl`
6. Migrate the active status badge from `bg-emerald-500` to `bg-primary` (hardcoded color migration)
7. Remove `ArrowLeft` from the lucide-react imports since back button is removed

Update the detail skeleton to match new layout (breadcrumb area + PageHeaderSkeleton + Card-wrapped skeleton content).

**Update tests:**
- `habits-page-content.test.tsx`: Title text assertions should still pass since PageHeader renders the same text. If tests query for specific heading structure, update accordingly. Run tests first to check which assertions break.
- `habit-detail-page.test.tsx`: Remove any assertions about "Back to Habits" button. Update heading assertions if they reference specific h1 structure. The Edit button is still present (same text, different location).
  </action>
  <verify>
Run `pnpm test:run -- --reporter verbose tests/app/habits/habits-page-content.test.tsx tests/app/habits/habit-detail-page.test.tsx` -- all tests pass. Run `pnpm lint` to verify no type errors.
  </verify>
  <done>
Habits list page uses PageHeader. Habit detail page has breadcrumbs, PageHeader with Edit action, and all content wrapped in a Card. Back button is removed. Tests updated and passing.
  </done>
</task>

<task type="auto">
  <name>Task 2: Migrate habits create and edit pages to PageHeader, breadcrumbs, and Card layout</name>
  <files>
    components/habits/create-habit-content.tsx
    components/habits/edit-habit-content.tsx
    tests/components/habits/create-habit-content.test.tsx
    tests/components/habits/edit-habit-content.test.tsx
  </files>
  <action>
**Create habit page (`create-habit-content.tsx`):**

Replace the current simple wrapper with breadcrumbs + PageHeader + Card:
```tsx
import { PageHeader } from "@/components/layouts/page-header";
import { PageBreadcrumbs } from "@/components/layouts/page-breadcrumbs";
import { Card, CardContent } from "@/components/ui/card";

// In the component:
const tBreadcrumb = useTranslations("habits.breadcrumb");

return (
  <div className="space-y-6">
    <div>
      <PageBreadcrumbs section="habits" itemName={tBreadcrumb("newHabit")} />
      <PageHeader
        title={t("form.createTitle")}
        actions={
          <>
            <Button variant="ghost" onClick={handleCancel} disabled={isLoading}>
              {t("form.cancel")}
            </Button>
            <Button type="submit" form="habit-form" disabled={isLoading}>
              {isLoading ? t("form.creating") : t("form.create")}
            </Button>
          </>
        }
      />
    </div>
    <Card className="max-w-2xl">
      <CardContent className="pt-6">
        <HabitForm
          id="habit-form"
          mode="create"
          onSubmit={handleSubmit}
          onCancel={handleCancel}
          isLoading={isLoading}
          hideChrome
        />
      </CardContent>
    </Card>
  </div>
);
```

Key details:
- Breadcrumb shows "Habits > New Habit" (per locked decision)
- Save/Cancel buttons in PageHeader actions slot (per locked decision)
- Submit button uses `form="habit-form"` to associate with the form element
- HabitForm receives `hideChrome` and `id="habit-form"` props
- Form wrapped in Card with `max-w-2xl` to maintain existing width constraint
- Remove the `max-w-2xl mx-auto` outer div wrapper (Card handles width)

**Edit habit page (`edit-habit-content.tsx`):**

Same pattern as create, but:
- Breadcrumb shows "Habits > {habit.name}" (per locked decision)
- Uses `t("form.editTitle")` for PageHeader title
- Submit button text: save/saving
- HabitForm receives `id="habit-form"` and `hideChrome`

```tsx
// After data loads:
<div className="space-y-6">
  <div>
    <PageBreadcrumbs section="habits" itemName={habit.name} />
    <PageHeader
      title={t("form.editTitle")}
      actions={
        <>
          <Button variant="ghost" onClick={handleCancel} disabled={isSubmitting}>
            {t("form.cancel")}
          </Button>
          <Button type="submit" form="habit-form" disabled={isSubmitting}>
            {isSubmitting ? t("form.saving") : t("form.save")}
          </Button>
        </>
      }
    />
  </div>
  <Card className="max-w-2xl">
    <CardContent className="pt-6">
      <HabitForm
        id="habit-form"
        mode="edit"
        initialData={habit}
        onSubmit={handleSubmit}
        onCancel={handleCancel}
        isLoading={isSubmitting}
        hideChrome
      />
    </CardContent>
  </Card>
</div>
```

Update the EditHabitSkeleton to show breadcrumb area + PageHeaderSkeleton + Card-wrapped skeleton.
Remove the `max-w-2xl mx-auto` from skeleton and error state divs.

**Update tests:**
- `create-habit-content.test.tsx`: The form title is now in PageHeader (h1) instead of HabitForm's internal h2. Update heading assertions. Cancel/submit button text may need updating if tests look for buttons inside the form.
- `edit-habit-content.test.tsx`: Same adjustments as create tests. Edit title in PageHeader, save/cancel in PageHeader actions.

Note: The form submit via `form="habit-form"` attribute works in real browsers but may need verification in jsdom. If jsdom doesn't support the `form` attribute for button click simulation, the test may need to find the form element and call `fireEvent.submit(form)` directly instead of clicking the submit button.
  </action>
  <verify>
Run `pnpm test:run -- --reporter verbose tests/components/habits/create-habit-content.test.tsx tests/components/habits/edit-habit-content.test.tsx` -- all tests pass. Run `pnpm lint`.
  </verify>
  <done>
Create and edit habit pages show breadcrumbs, use PageHeader with Save/Cancel in actions slot, and wrap the form in a Card. HabitForm uses hideChrome and id props. Tests updated and passing.
  </done>
</task>

</tasks>

<verification>
1. `pnpm test:run -- --reporter verbose tests/app/habits/ tests/components/habits/` -- all habit-related tests pass
2. `pnpm lint` passes
3. Visual check: Habits list has PageHeader, detail has breadcrumbs + Card, create/edit have breadcrumbs + Card + PageHeader actions
</verification>

<success_criteria>
- All 4 habits pages migrated to PageHeader with consistent layout
- Detail page: breadcrumbs replace back button, content wrapped in Card
- Create/edit pages: breadcrumbs, form in Card, Save/Cancel in PageHeader
- All existing tests updated and passing
</success_criteria>

<output>
After completion, create `.planning/phases/06-habits-tasks-remaining-pages-migration/06-02-SUMMARY.md`
</output>
