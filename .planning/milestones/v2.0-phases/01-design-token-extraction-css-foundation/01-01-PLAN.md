---
phase: 01-design-token-extraction-css-foundation
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - app/globals.css
autonomous: true

must_haves:
  truths:
    - "CSS custom properties define a --page token for the gray canvas and --card for white surfaces in :root (light mode)"
    - "Dark mode .dark block uses 3 elevation levels: --background (darkest), --card (mid), --popover (lightest) with ~4% lightness steps"
    - "Sidebar CSS variables use raw HSL values (space-separated numbers, no hsl() wrapper) matching all other shadcn tokens"
    - "No dead Tailwind v4 directives remain (@custom-variant, @theme inline)"
    - "Only one @layer base block exists (no duplicates)"
    - "Typography scale, spacing, and layout custom properties are defined"
    - "Primary accent color is updated to Chameleon's green/teal (157 63% 45% in light, 160 60% 50% in dark)"
  artifacts:
    - path: "app/globals.css"
      provides: "Complete design token system with light/dark themes"
      contains: "--page:"
  key_links:
    - from: "app/globals.css"
      to: "tailwind.config.ts"
      via: "CSS custom properties consumed by hsl(var(--xxx)) in Tailwind config"
      pattern: "--page:|--highlight:|--sidebar-background:"
---

<objective>
Rewrite globals.css to establish the complete design token system: clean up dead TW4 directives and duplicate @layer base blocks, replace token values with Chameleon-extracted values for light mode, add new semantic surface tokens (--page, --highlight), convert sidebar variables to raw HSL format, define a Linear-inspired 3-level dark mode elevation system, and add typography/spacing/layout custom properties.

Purpose: Every subsequent phase depends on these tokens being correct and complete. This is the visual foundation of the entire redesign.
Output: A clean, consolidated globals.css with all design tokens for both themes.
</objective>

<execution_context>
@/home/xingdi/.claude/get-shit-done/workflows/execute-plan.md
@/home/xingdi/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-design-token-extraction-css-foundation/01-CONTEXT.md
@.planning/phases/01-design-token-extraction-css-foundation/01-RESEARCH.md
@app/globals.css
@tailwind.config.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Clean up globals.css structure and remove dead code</name>
  <files>app/globals.css</files>
  <action>
Read the current `app/globals.css` (113 lines). Perform these structural cleanups:

1. **Remove the dead `@custom-variant` directive** (line 2): `@custom-variant dark (&:is(.dark *));` -- this is a Tailwind v4 directive that is silently ignored by Tailwind 3.4.17. The project uses `darkMode: ["class"]` in `tailwind.config.ts` instead.

2. **Remove the entire `@theme inline` block** (lines 94-103): This is dead code under Tailwind 3. The sidebar variables it references will be moved into @layer base.

3. **Remove the standalone `:root` and `.dark` sidebar blocks** (lines 72-92): These will be merged into the main @layer base :root and .dark blocks.

4. **Consolidate the three `@layer base` blocks** (lines 7-61, 63-70, 105-112) into a single `@layer base` block. Keep only one `*` rule and one `body` rule. The `*` rule should use `@apply border-border;` (drop the `outline-ring/50` from the third block since `outline-ring/50` uses Tailwind v4 arbitrary syntax that may not work correctly in TW3).

The result should be a single clean structure:
```
@tailwind base;
@tailwind components;
@tailwind utilities;

@layer base {
  :root { ... all light mode tokens ... }
  .dark { ... all dark mode tokens ... }
  * { @apply border-border; }
  body { @apply bg-background text-foreground; }
}
```

Do NOT change any token VALUES yet -- this task is purely structural cleanup. All existing variable values should be preserved exactly as-is (they will be updated in Task 2).
  </action>
  <verify>
Run `pnpm build` to confirm no CSS compilation errors. The build should succeed with no errors related to globals.css. Also visually confirm the file has exactly one `@layer base` block, no `@custom-variant`, no `@theme inline`, and no standalone `:root`/`.dark` blocks outside @layer base.
  </verify>
  <done>globals.css has a single clean @layer base block with all variables consolidated, zero dead TW4 directives, and the build passes.</done>
</task>

<task type="auto">
  <name>Task 2: Replace token values with Chameleon-extracted design system</name>
  <files>app/globals.css</files>
  <action>
Starting from the cleaned-up globals.css (from Task 1), replace ALL token values with the complete design token system. Use the exact values from the research document's "Recommended Token Organization" section, with adjustments per user decisions.

**IMPORTANT user decision:** Main content area background is white (or very near-white) -- NOT gray. The `--background` token stays white (`0 0% 100%`). The NEW `--page` token provides the gray canvas (`216 25% 97%`).

Write the complete `:root` block with these values:

```css
/* === Core surface tokens === */
--background: 0 0% 100%;           /* White -- content area default */
--foreground: 0 0% 3.9%;

/* === Surface hierarchy (NEW) === */
--page: 216 25% 97%;               /* Gray canvas behind cards -- Chameleon page bg */
--card: 0 0% 100%;                 /* White card surface */
--card-foreground: 0 0% 3.9%;
--popover: 0 0% 100%;
--popover-foreground: 0 0% 3.9%;

/* === Accent / Brand === */
--primary: 157 63% 45%;            /* Chameleon green/teal (was 160 84% 39%) */
--primary-foreground: 0 0% 100%;
--ring: 157 63% 45%;

/* === Neutral semantic === */
--secondary: 216 16% 96%;
--secondary-foreground: 0 0% 9%;
--muted: 216 16% 96%;
--muted-foreground: 0 0% 45%;
--accent: 216 16% 96%;
--accent-foreground: 0 0% 9%;

/* === Borders === */
--border: 216 16% 91%;             /* Chameleon card border gray */
--input: 216 16% 91%;

/* === Destructive === */
--destructive: 0 84.2% 60.2%;
--destructive-foreground: 0 0% 98%;

/* === Radius === */
--radius: 0.75rem;                 /* 12px -- Chameleon card radius (was 0.5rem) */

/* === Sidebar (raw HSL format -- converted from hsl() wrappers) === */
--sidebar-background: 220 20% 98%;
--sidebar-foreground: 240 5.3% 26.1%;
--sidebar-primary: 157 63% 45%;
--sidebar-primary-foreground: 0 0% 100%;
--sidebar-accent: 216 24% 95%;
--sidebar-accent-foreground: 240 5.9% 10%;
--sidebar-border: 216 16% 91%;
--sidebar-ring: 157 63% 45%;

/* === Highlight === */
--highlight: 155 50% 94%;          /* Light green row highlight */

/* === Typography scale === */
--font-size-page-title: 1.75rem;   /* 28px */
--font-size-section-heading: 1.125rem; /* 18px */
--font-size-body: 0.875rem;        /* 14px */
--font-size-caption: 0.8125rem;    /* 13px */
--font-size-stat: 1.75rem;         /* 28px */

/* === Spacing === */
--spacing-card-padding: 1.5rem;    /* 24px -- Chameleon card padding */
--spacing-page-padding: 2rem;      /* 32px */
--spacing-card-gap: 1.5rem;        /* 24px */

/* === Layout === */
--sidebar-width: 200px;
--sidebar-width-mobile: 280px;
--sidebar-width-icon: 48px;

/* === Chart colors (preserved) === */
--chart-1: 12 76% 61%;
--chart-2: 173 58% 39%;
--chart-3: 197 37% 24%;
--chart-4: 43 74% 66%;
--chart-5: 27 87% 67%;
```

Write the complete `.dark` block with Linear-inspired elevation values:

```css
/* === Base surface (Level 0 -- darkest, ~#1a1a2e) === */
--background: 240 27% 14%;
--foreground: 0 0% 95%;

/* === Surface hierarchy === */
--page: 240 27% 14%;               /* Same as background in dark */
--card: 240 25% 18%;               /* Level 1 -- elevated (+4% lightness) */
--card-foreground: 0 0% 95%;
--popover: 240 24% 22%;            /* Level 2 -- highest (+4% more) */
--popover-foreground: 0 0% 95%;

/* === Accent === */
--primary: 160 60% 50%;            /* Slightly lighter teal for dark backgrounds */
--primary-foreground: 0 0% 9%;
--ring: 160 60% 50%;

/* === Neutral semantic === */
--secondary: 240 15% 20%;
--secondary-foreground: 0 0% 95%;
--muted: 240 15% 20%;
--muted-foreground: 240 5% 60%;
--accent: 240 15% 20%;
--accent-foreground: 0 0% 95%;

/* === Borders === */
--border: 240 15% 25%;
--input: 240 15% 25%;

/* === Destructive === */
--destructive: 0 62.8% 30.6%;
--destructive-foreground: 0 0% 98%;

/* === Sidebar (darker than content -- sidebar recedes) === */
--sidebar-background: 240 28% 12%;
--sidebar-foreground: 240 5% 85%;
--sidebar-primary: 160 60% 50%;
--sidebar-primary-foreground: 0 0% 9%;
--sidebar-accent: 240 15% 18%;
--sidebar-accent-foreground: 240 5% 85%;
--sidebar-border: 240 15% 20%;
--sidebar-ring: 160 60% 50%;

/* === Highlight === */
--highlight: 160 30% 20%;

/* === Chart colors === */
--chart-1: 220 70% 50%;
--chart-2: 160 60% 45%;
--chart-3: 30 80% 55%;
--chart-4: 280 65% 60%;
--chart-5: 340 75% 55%;
```

The final globals.css should be well-organized with clear section comments, containing: @tailwind directives, one @layer base block with :root, .dark, *, and body rules.
  </action>
  <verify>
1. Run `pnpm build` -- must succeed with no errors.
2. Run `pnpm lint` -- must pass.
3. Verify with grep that:
   - `--page:` exists in both :root and .dark
   - `--highlight:` exists in both :root and .dark
   - `--sidebar-background:` exists (not `--sidebar:`)
   - No `hsl(` appears in any variable value (raw HSL only)
   - `--radius: 0.75rem` is set
   - `--primary: 157 63% 45%` is in :root
   - `--font-size-page-title:` exists
   - `--spacing-card-padding:` exists
   - `--sidebar-width:` exists
  </verify>
  <done>globals.css contains the complete Chameleon-extracted design token system for light mode, Linear-inspired dark mode with 3 elevation levels, sidebar tokens in raw HSL format, typography scale, spacing tokens, and layout dimensions. Build and lint pass.</done>
</task>

</tasks>

<verification>
1. `pnpm build` passes (no CSS errors)
2. `pnpm lint` passes
3. globals.css has exactly one `@layer base` block
4. No `@custom-variant` or `@theme inline` in the file
5. No `hsl(` wrappers in any CSS variable value
6. New tokens present: --page, --highlight, --sidebar-background, --font-size-*, --spacing-*, --sidebar-width*
7. :root has --primary: 157 63% 45% (Chameleon green)
8. .dark has --background: 240 27% 14% (Linear-inspired base)
9. .dark has 3 elevation levels with ~4% lightness steps (14%, 18%, 22%)
10. .dark sidebar at 240 28% 12% (darker than content area)
</verification>

<success_criteria>
- globals.css is clean, consolidated, and contains the complete design token system
- All Chameleon-extracted values are encoded as CSS custom properties
- Dark mode uses Linear-inspired 3-level elevation system
- Sidebar variables use raw HSL format matching all other shadcn tokens
- Dead TW4 code is removed
- Build and lint pass successfully
</success_criteria>

<output>
After completion, create `.planning/phases/01-design-token-extraction-css-foundation/01-01-SUMMARY.md`
</output>
