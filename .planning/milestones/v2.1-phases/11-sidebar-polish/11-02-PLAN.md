---
phase: 11-sidebar-polish
plan: 02
type: execute
wave: 2
depends_on: ["11-01"]
files_modified:
  - tests/components/layouts/app-sidebar.test.tsx
  - tests/components/layouts/sidebar-user-footer.test.tsx
autonomous: false
requirements: [SIDE-01, SIDE-02, SIDE-03]

must_haves:
  truths:
    - "All sidebar tests pass after structural changes from Plan 01"
    - "Tests verify the flat 3-item nav structure (no group labels, no Settings link)"
    - "Tests verify icon containers render for each nav item"
    - "Tests verify footer uses Settings (gear) icon"
    - "Visual verification confirms Chameleon-matched sidebar appearance"
  artifacts:
    - path: "tests/components/layouts/app-sidebar.test.tsx"
      provides: "Updated tests matching flat sidebar structure"
      contains: "renders all 3 nav items"
    - path: "tests/components/layouts/sidebar-user-footer.test.tsx"
      provides: "Updated tests verifying gear icon in footer"
  key_links:
    - from: "tests/components/layouts/app-sidebar.test.tsx"
      to: "components/layouts/app-sidebar.tsx"
      via: "Test assertions match component output"
      pattern: "getAllByRole.*link"
---

<objective>
Update sidebar tests to match the restructured flat navigation from Plan 01, and visually verify the sidebar matches the Chameleon design reference.

Purpose: Ensure test suite passes after the structural sidebar changes and confirm visual quality matches the design reference.
Output: Passing test suite and human-verified visual result.
</objective>

<execution_context>
@/home/xingdi/.claude/get-shit-done/workflows/execute-plan.md
@/home/xingdi/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/11-sidebar-polish/11-CONTEXT.md
@.planning/phases/11-sidebar-polish/11-01-SUMMARY.md
@tests/components/layouts/app-sidebar.test.tsx
@tests/components/layouts/sidebar-user-footer.test.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Update sidebar tests for flat nav structure and footer changes</name>
  <files>tests/components/layouts/app-sidebar.test.tsx, tests/components/layouts/sidebar-user-footer.test.tsx</files>
  <action>
**app-sidebar.test.tsx -- Update for flat nav structure:**

1. **Update link count assertions:** Change from 4 links to 3 links throughout:
   - `"renders all 4 nav items as links"` -> `"renders all 3 nav items as links"` with `expect(links).toHaveLength(3)`
   - `"renders correct hrefs"` -> update to check only 3 hrefs: `/dashboard`, `/habits`, `/tasks` (remove `/dashboard/settings`)

2. **Update label assertions:** Remove `settings` from label checks:
   - `"renders i18n translation keys"` -> check only `dashboard`, `habits`, `tasks`

3. **Remove or update group label test:** The test `"renders sidebar group labels"` should be removed entirely since collapsible groups are gone. The mock for `SidebarGroupLabel` can remain in case it's still imported, but the test asserting `mainGroup` and `accountGroup` text must be deleted.

4. **Remove Settings-specific tests:** Delete the test `"highlights settings link when pathname is /dashboard/settings"` and update `"does not highlight dashboard when on /dashboard/settings"` to use a different route (e.g., `/habits` instead).

5. **Remove Collapsible mock:** Remove the `vi.mock("@/components/ui/collapsible"...)` block since Collapsible is no longer imported by AppSidebar.

6. **Add icon container test:** Add a new test verifying icon containers render. Since we're using mocked components, add a test that checks for the icon container div. The mock for SidebarMenuButton with `asChild` will render the Link which contains the icon container div. Check for elements with the expected class:
   ```ts
   it("renders icon containers for each nav item", () => {
     render(<AppSidebar {...defaultProps} />);
     // The icon containers are divs with size-6 class inside each link
     const links = screen.getAllByRole("link");
     links.forEach((link) => {
       const iconContainer = link.querySelector(".size-6");
       expect(iconContainer).toBeInTheDocument();
     });
   });
   ```

7. **Update badge tests:** The badge tests check for 2 badges when both habits and tasks have counts. Update `"does not show badge for dashboard"` -- it should still expect 2 badges (habits + tasks) since dashboard still has no badge. This test should still pass unchanged.

**sidebar-user-footer.test.tsx -- Update for gear icon:**

Read the existing test file first. Then:

1. If there's a test checking for ChevronsUpDown icon presence, update it to check for Settings/gear icon instead.
2. If there's no specific icon test, no changes needed to this file (the component still renders the same dropdown structure, just with a different icon).

**Run tests after changes:**
```bash
pnpm test:run -- tests/components/layouts/app-sidebar.test.tsx tests/components/layouts/sidebar-user-footer.test.tsx
```

Fix any remaining failures iteratively.
  </action>
  <verify>`pnpm test:run -- tests/components/layouts/app-sidebar.test.tsx tests/components/layouts/sidebar-user-footer.test.tsx` -- all tests pass. Then `pnpm test:run` for full suite (expect pre-existing habit-logs failures only).</verify>
  <done>All sidebar-related tests pass. Tests verify: 3 nav items (not 4), no group labels, icon containers present, correct active state highlighting, badge counts, footer functionality. Full test suite has no new failures.</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <name>Task 2: Visual verification of Chameleon-matched sidebar</name>
  <files>components/layouts/app-sidebar.tsx, components/layouts/sidebar-user-footer.tsx</files>
  <action>
Human visually verifies the complete sidebar redesign matches the Chameleon reference. The sidebar was restructured in Plan 01 (tokens, flat nav, icon containers, hover/active states, footer icon). This checkpoint confirms the visual result before marking the phase complete.

Steps for verification:
1. Run `pnpm dev` and open http://localhost:3000/dashboard
2. Check sidebar width is 224px (visibly wider than before)
3. Confirm flat nav: Dashboard, Habits, Tasks only (no group headers, no Settings)
4. Confirm icon containers: each icon in a white rounded box
5. Test hover: smooth teal tint with inset ring on 0.2s transition
6. Test active: blue-gray bg with gray inset ring on current page
7. Check footer: gear icon, same teal hover
8. Test dark mode and collapsed mode
9. Compare with chameleon-sidebar.png, chameleon-hover-state.png, chameleon-active-state.png
  </action>
  <verify>Human confirms sidebar visually matches Chameleon reference in light mode, dark mode, and collapsed state.</verify>
  <done>Human approves the sidebar visual design or provides specific feedback for adjustments.</done>
</task>

</tasks>

<verification>
1. `pnpm test:run` -- all tests pass (except pre-existing habit-logs failures)
2. `pnpm build` -- production build succeeds
3. `pnpm lint` -- no new lint errors
4. Human visual verification confirms Chameleon-matched sidebar
</verification>

<success_criteria>
- All sidebar tests pass reflecting the new 3-item flat structure
- No new test failures introduced
- Human confirms visual match to Chameleon reference
- Both light and dark mode look polished
- Collapsed/expanded sidebar transitions work correctly
</success_criteria>

<output>
After completion, create `.planning/phases/11-sidebar-polish/11-02-SUMMARY.md`
</output>
