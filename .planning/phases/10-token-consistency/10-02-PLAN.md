---
phase: 10-token-consistency
plan: 02
type: execute
wave: 2
depends_on:
  - "10-01"
files_modified:
  - lib/habits/format.ts
  - components/habits/heatmap.tsx
  - components/habits/habit-card.tsx
  - components/habits/habit-form.tsx
  - components/habits/habit-row.tsx
  - components/habits/habit-empty-state.tsx
  - components/habits/habit-detail-content.tsx
  - components/habits/streak-counter.tsx
  - components/dashboard/absence-card.tsx
  - components/dashboard/weekly-insight-card.tsx
  - components/dashboard/daily-snapshot.tsx
  - components/dashboard/tasks-today.tsx
  - tests/components/habits/heatmap.test.tsx
  - tests/components/dashboard/daily-snapshot.test.tsx
autonomous: true
requirements:
  - TOKN-01
  - TOKN-03
must_haves:
  truths:
    - "Zero hardcoded Tailwind color classes remain in habit component files"
    - "Zero hardcoded Tailwind color classes remain in dashboard component files"
    - "Progress bar track in habit-card.tsx uses bg-muted instead of bg-slate-200 dark:bg-slate-700"
    - "Heatmap missed cells use bg-muted instead of bg-slate-200"
    - "Category colors reference semantic tokens (bg-category-health, text-category-health, etc.)"
    - "All existing tests pass after color migration"
  artifacts:
    - path: "lib/habits/format.ts"
      provides: "Category color function returning semantic token classes"
      contains: "category-health"
    - path: "components/habits/habit-card.tsx"
      provides: "Progress bar track with bg-muted"
      contains: "bg-muted"
    - path: "components/habits/heatmap.tsx"
      provides: "Heatmap cells using semantic tokens"
      contains: "bg-muted"
  key_links:
    - from: "lib/habits/format.ts"
      to: "components/habits/habit-card.tsx"
      via: "getCategoryColor import"
      pattern: "getCategoryColor"
    - from: "components/habits/heatmap.tsx"
      to: "app/globals.css"
      via: "semantic token classes"
      pattern: "bg-muted"
---

<objective>
Replace all hardcoded Tailwind color classes in habit components, dashboard components, and the shared format utility with semantic design tokens defined in Plan 01.

Purpose: Achieve zero hardcoded color classes in habit and dashboard component files, ensuring consistent theming in light and dark mode. Includes the critical TOKN-03 progress bar fix.

Output: All habit and dashboard component files use semantic tokens. Test assertions updated to match new class names.
</objective>

<execution_context>
@/home/xingdi/.claude/get-shit-done/workflows/execute-plan.md
@/home/xingdi/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/10-token-consistency/10-01-SUMMARY.md
@.planning/milestones/v2.0-phases/01-design-token-extraction-css-foundation/DESIGN-TOKENS.md
@app/globals.css
@tailwind.config.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Migrate habit components and shared format utility</name>
  <files>
    lib/habits/format.ts
    components/habits/heatmap.tsx
    components/habits/habit-card.tsx
    components/habits/habit-form.tsx
    components/habits/habit-row.tsx
    components/habits/habit-empty-state.tsx
    components/habits/habit-detail-content.tsx
    components/habits/streak-counter.tsx
    tests/components/habits/heatmap.test.tsx
  </files>
  <action>
Replace every hardcoded Tailwind color class in habit component files with semantic tokens. Use the following mapping:

**lib/habits/format.ts — getCategoryColor():**
- `"text-rose-500 bg-rose-50"` → `"text-category-health bg-category-health-muted"`
- `"text-purple-500 bg-purple-50"` → `"text-category-wellness bg-category-wellness-muted"`
- `"text-blue-500 bg-blue-50"` → `"text-category-learning bg-category-learning-muted"`
- `"text-amber-500 bg-amber-50"` → `"text-category-productivity bg-category-productivity-muted"`
- `"text-slate-500 bg-slate-50"` → `"text-category-other bg-category-other-muted"`

**components/habits/heatmap.tsx:**
- Missed cells: `"bg-slate-200"` → `"bg-muted"`
- Not-scheduled cells: `"border border-dashed border-slate-300 bg-transparent"` → `"border border-dashed border-border bg-transparent"`
- Loading skeleton cells: `"bg-slate-100"` → `"bg-muted"`
- Legend missed marker: `"bg-slate-200"` → `"bg-muted"`
- Legend not-scheduled marker: `"border border-dashed border-slate-300"` → `"border border-dashed border-border"`

**components/habits/habit-card.tsx (TOKN-03):**
- Progress bar track: `"bg-slate-200 dark:bg-slate-700"` → `"bg-muted"`
- Streak fire icon: `"text-orange-500"` → `"text-status-streak"`

**components/habits/habit-form.tsx — CATEGORIES array:**
- `"data-[state=on]:bg-rose-500 data-[state=on]:text-white"` → `"data-[state=on]:bg-category-health data-[state=on]:text-white"`
- `"data-[state=on]:bg-purple-500 data-[state=on]:text-white"` → `"data-[state=on]:bg-category-wellness data-[state=on]:text-white"`
- `"data-[state=on]:bg-blue-500 data-[state=on]:text-white"` → `"data-[state=on]:bg-category-learning data-[state=on]:text-white"`
- `"data-[state=on]:bg-amber-500 data-[state=on]:text-white"` → `"data-[state=on]:bg-category-productivity data-[state=on]:text-white"`
- `"data-[state=on]:bg-slate-500 data-[state=on]:text-white"` → `"data-[state=on]:bg-category-other data-[state=on]:text-white"`

**components/habits/habit-row.tsx:**
- Streak fire icon: `"text-orange-500"` → `"text-status-streak"`

**components/habits/habit-empty-state.tsx:**
- Icon colors: `"text-amber-500"` → `"text-status-warning"`, `"text-slate-400"` → `"text-muted-foreground"`
- Icon backgrounds: `"bg-amber-100"` → `"bg-status-warning/20"`, `"bg-slate-100"` → `"bg-muted"`
- Celebration gradient: `"bg-gradient-to-b from-amber-50/50 to-transparent"` → `"bg-gradient-to-b from-empty-state-celebration-bg/50 to-transparent"`

**components/habits/habit-detail-content.tsx:**
- Category color map: `"bg-rose-500"` → `"bg-category-health"`, `"bg-purple-500"` → `"bg-category-wellness"`, `"bg-blue-500"` → `"bg-category-learning"`, `"bg-amber-500"` → `"bg-category-productivity"`, `"bg-slate-500"` → `"bg-category-other"`
- Fallback category: `"bg-slate-500"` → `"bg-category-other"`
- Paused status: `"bg-amber-500"` → `"bg-status-warning"`
- Archived status: `"bg-slate-500"` → `"bg-category-other"`

**components/habits/streak-counter.tsx:**
- Fire icons: `"text-orange-500"` → `"text-status-streak"` (all instances)
- Streak count text: `"text-orange-500"` → `"text-status-streak"`

**tests/components/habits/heatmap.test.tsx:**
- `expect(cell).toHaveClass('bg-slate-200')` → `expect(cell).toHaveClass('bg-muted')`

Do NOT touch `components/ui/` files. Preserve all existing functionality, props, and component structure. Only change color class values.
  </action>
  <verify>
Run `pnpm test:run -- --testPathPattern="habits|heatmap"` to verify habit-related tests pass. Run `pnpm lint` to verify no lint errors.
  </verify>
  <done>
Zero hardcoded Tailwind color classes remain in any habit component file or in `lib/habits/format.ts`. Progress bar track in `habit-card.tsx` uses `bg-muted`. Heatmap uses semantic tokens. All habit tests pass.
  </done>
</task>

<task type="auto">
  <name>Task 2: Migrate dashboard components</name>
  <files>
    components/dashboard/absence-card.tsx
    components/dashboard/weekly-insight-card.tsx
    components/dashboard/daily-snapshot.tsx
    components/dashboard/tasks-today.tsx
    tests/components/dashboard/daily-snapshot.test.tsx
  </files>
  <action>
Replace every hardcoded Tailwind color class in dashboard component files with semantic tokens:

**components/dashboard/absence-card.tsx:**
Replace the variant config object:
- `bg: "bg-amber-50 dark:bg-amber-950/20"` → `bg: "bg-absence-warning-bg"`
- `iconColor: "text-amber-500"` → `iconColor: "text-absence-warning-icon"`
- `titleColor: "text-amber-700 dark:text-amber-400"` → `titleColor: "text-absence-warning-title"`
- `bg: "bg-blue-50 dark:bg-blue-950/20"` → `bg: "bg-absence-info-bg"`
- `iconColor: "text-blue-500"` → `iconColor: "text-absence-info-icon"`
- `titleColor: "text-blue-700 dark:text-blue-400"` → `titleColor: "text-absence-info-title"`
- `bg: "bg-orange-50 dark:bg-orange-950/20"` → `bg: "bg-absence-caution-bg"`
- `iconColor: "text-orange-500"` → `iconColor: "text-absence-caution-icon"`
- `titleColor: "text-orange-700 dark:text-orange-400"` → `titleColor: "text-absence-caution-title"`

**components/dashboard/weekly-insight-card.tsx:**
- Card bg: `"bg-gradient-to-r from-blue-50 to-indigo-50 dark:from-blue-950/30 dark:to-indigo-950/30 border-blue-200 dark:border-blue-800"` → `"bg-gradient-to-r from-info-card to-info-card-to border-info-card-border"`
- Brain icon: `"text-blue-600 dark:text-blue-400"` → `"text-info-card-icon"`
- Title text: `"text-blue-900 dark:text-blue-100"` → `"text-info-card-text"`
- Body text: `"text-blue-700 dark:text-blue-300"` → `"text-info-card-text-secondary"`
- Dismiss button: `"text-blue-500 hover:text-blue-700 hover:bg-blue-100 dark:hover:bg-blue-900"` → `"text-info-card-button hover:text-info-card-button-hover hover:bg-info-card-button-hover-bg"`

**components/dashboard/daily-snapshot.tsx:**
- Negative trend: `"text-red-500"` → `"text-status-error"`
- Target icon: `"text-blue-600 dark:text-blue-400"` → `"text-stat-icon-blue"`
- Target icon bg: `"bg-blue-100 dark:bg-blue-900/30"` → `"bg-stat-icon-blue-bg"`
- Flame icon: `"text-orange-600 dark:text-orange-400"` → `"text-stat-icon-orange"`
- Flame icon bg: `"bg-orange-100 dark:bg-orange-900/30"` → `"bg-stat-icon-orange-bg"`

**components/dashboard/tasks-today.tsx:**
Priority color maps (there are two: one near top-level and one inline):
- `1: "text-green-500"` → `1: "text-priority-low"`
- `2: "text-yellow-500"` → `2: "text-priority-medium"`
- `3: "text-red-500"` → `3: "text-priority-high"`

Due date overdue:
- `"text-red-500 font-medium"` → `"text-status-error font-medium"` (if present)

**tests/components/dashboard/daily-snapshot.test.tsx:**
- `expect(trendElement.parentElement).toHaveClass("text-red-500")` → `expect(trendElement.parentElement).toHaveClass("text-status-error")`

Do NOT touch `components/ui/` files. Preserve all existing functionality.
  </action>
  <verify>
Run `pnpm test:run -- --testPathPattern="dashboard|daily-snapshot|absence|weekly-insight|tasks-today"` to verify dashboard tests pass. Run `pnpm lint` to verify no lint errors.
  </verify>
  <done>
Zero hardcoded Tailwind color classes remain in dashboard component files. All dashboard tests pass. Absence card, weekly insight card, daily snapshot, and tasks-today all use semantic tokens.
  </done>
</task>

</tasks>

<verification>
1. `pnpm test:run` — all tests pass (including updated assertions)
2. `pnpm lint` — no lint errors
3. `pnpm build` — production build succeeds
4. Grep for hardcoded colors in modified files returns zero matches:
   `grep -rn 'bg-slate\|bg-gray\|text-slate\|text-gray\|border-slate\|text-red-\|text-green-\|text-yellow-\|text-blue-\|text-orange-\|text-amber-\|text-rose-\|text-purple-\|bg-rose-\|bg-purple-\|bg-blue-\|bg-amber-\|bg-orange-\|bg-indigo-\|border-blue-\|from-blue-\|to-indigo-\|from-amber-' components/habits/ components/dashboard/ lib/habits/`
</verification>

<success_criteria>
- Zero hardcoded Tailwind color classes in habit or dashboard component files
- Progress bar track uses bg-muted (TOKN-03)
- Heatmap cells use semantic tokens
- Category colors in format.ts use semantic tokens
- All existing tests pass with updated assertions
</success_criteria>

<output>
After completion, create `.planning/phases/10-token-consistency/10-02-SUMMARY.md`
</output>
