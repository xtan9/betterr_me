---
phase: 01-design-token-extraction-css-foundation
plan: 02
type: execute
wave: 1
depends_on:
  - "01-01"
files_modified:
  - tailwind.config.ts
autonomous: true

must_haves:
  truths:
    - "Tailwind utility classes bg-page, bg-highlight, bg-sidebar work and produce correct colors"
    - "Sidebar color utilities (bg-sidebar, text-sidebar-foreground, etc.) map to the raw HSL sidebar tokens in globals.css"
    - "Hardcoded emerald/green Tailwind classes in the codebase are documented for future cleanup"
    - "Design tokens are documented with Chameleon source values and intended usage"
  artifacts:
    - path: "tailwind.config.ts"
      provides: "Tailwind color/spacing/typography registrations for new CSS tokens"
      contains: "page:"
    - path: ".planning/phases/01-design-token-extraction-css-foundation/DESIGN-TOKENS.md"
      provides: "Token reference documentation"
      contains: "page"
  key_links:
    - from: "tailwind.config.ts"
      to: "app/globals.css"
      via: "hsl(var(--xxx)) consuming raw HSL custom properties"
      pattern: "hsl\\(var\\(--page\\)\\)"
    - from: "tailwind.config.ts"
      to: "app/globals.css"
      via: "sidebar color registration"
      pattern: "hsl\\(var\\(--sidebar-background\\)\\)"
---

<objective>
Register all new CSS custom properties in tailwind.config.ts so they work as Tailwind utility classes (bg-page, bg-highlight, bg-sidebar, etc.), audit the codebase for hardcoded emerald/green color classes that won't respond to the new --primary token, and create a design token reference document.

Purpose: Without Tailwind registration, the CSS variables exist but cannot be used as utility classes (bg-page would not work). The audit identifies tech debt for future phases. The documentation serves as the reference for all subsequent phases.
Output: Updated tailwind.config.ts, hardcoded color audit, and DESIGN-TOKENS.md reference.
</objective>

<execution_context>
@/home/xingdi/.claude/get-shit-done/workflows/execute-plan.md
@/home/xingdi/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-design-token-extraction-css-foundation/01-CONTEXT.md
@.planning/phases/01-design-token-extraction-css-foundation/01-RESEARCH.md
@.planning/phases/01-design-token-extraction-css-foundation/01-01-SUMMARY.md
@app/globals.css
@tailwind.config.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Register new design tokens in tailwind.config.ts</name>
  <files>tailwind.config.ts</files>
  <action>
Read the current `tailwind.config.ts` and add registrations for ALL new CSS custom properties so they work as Tailwind utility classes. The existing color registrations (background, foreground, card, popover, primary, secondary, muted, accent, destructive, border, input, ring, chart) must be preserved.

Add to `theme.extend.colors`:

```typescript
page: "hsl(var(--page))",
highlight: "hsl(var(--highlight))",
sidebar: {
  DEFAULT: "hsl(var(--sidebar-background))",
  foreground: "hsl(var(--sidebar-foreground))",
  primary: "hsl(var(--sidebar-primary))",
  "primary-foreground": "hsl(var(--sidebar-primary-foreground))",
  accent: "hsl(var(--sidebar-accent))",
  "accent-foreground": "hsl(var(--sidebar-accent-foreground))",
  border: "hsl(var(--sidebar-border))",
  ring: "hsl(var(--sidebar-ring))",
},
```

Add to `theme.extend.fontSize` (mapping typography scale tokens to Tailwind utilities):

```typescript
fontSize: {
  "page-title": ["var(--font-size-page-title)", { lineHeight: "1.2", fontWeight: "700" }],
  "section-heading": ["var(--font-size-section-heading)", { lineHeight: "1.3", fontWeight: "600" }],
  body: ["var(--font-size-body)", { lineHeight: "1.5", fontWeight: "400" }],
  caption: ["var(--font-size-caption)", { lineHeight: "1.4", fontWeight: "400" }],
  stat: ["var(--font-size-stat)", { lineHeight: "1.2", fontWeight: "700" }],
},
```

Add to `theme.extend.spacing` (mapping spacing tokens):

```typescript
spacing: {
  "card-padding": "var(--spacing-card-padding)",
  "page-padding": "var(--spacing-page-padding)",
  "card-gap": "var(--spacing-card-gap)",
},
```

Add to `theme.extend.width` (sidebar dimensions):

```typescript
width: {
  sidebar: "var(--sidebar-width)",
  "sidebar-mobile": "var(--sidebar-width-mobile)",
  "sidebar-icon": "var(--sidebar-width-icon)",
},
```

This enables usage like:
- `bg-page` for gray canvas
- `bg-highlight` for highlighted rows
- `bg-sidebar` for sidebar background
- `text-page-title` for page titles
- `p-card-padding` for card internal padding
- `w-sidebar` for sidebar width
  </action>
  <verify>
1. Run `pnpm build` -- must succeed (Tailwind processes config without errors).
2. Run `pnpm lint` -- must pass.
3. Verify the config file contains: `page:`, `highlight:`, `sidebar:`, `fontSize:`, `spacing:` with `card-padding`, `width:` with `sidebar`.
  </verify>
  <done>All new CSS custom properties are registered in tailwind.config.ts and available as Tailwind utility classes. Build and lint pass.</done>
</task>

<task type="auto">
  <name>Task 2: Audit hardcoded colors and create token reference document</name>
  <files>.planning/phases/01-design-token-extraction-css-foundation/DESIGN-TOKENS.md</files>
  <action>
**Part A: Audit hardcoded emerald/green classes**

Search the codebase (excluding `components/ui/`, `node_modules/`, and test files) for hardcoded Tailwind color classes that use `emerald-` or `green-` prefixes. These classes will NOT respond to the `--primary` token change and represent tech debt for future phases.

Run searches for patterns like: `emerald-`, `green-`, `bg-emerald`, `text-emerald`, `border-emerald`, `bg-green`, `text-green`, `border-green`.

Record each file and the specific classes found. This audit is informational only -- do NOT change these files in this phase (that belongs to page migration phases 5-6).

**Part B: Create DESIGN-TOKENS.md reference**

Create `.planning/phases/01-design-token-extraction-css-foundation/DESIGN-TOKENS.md` documenting ALL extracted design tokens with:

1. **Token reference table** -- Every CSS custom property with its :root value, .dark value, Tailwind utility class, and intended usage
2. **Surface hierarchy** -- Visual explanation of the light and dark mode elevation systems
3. **Color palette** -- All color tokens grouped by purpose (surfaces, brand, neutral, borders, charts)
4. **Typography scale** -- All font size tokens with their pixel equivalents, weights, and line heights
5. **Spacing scale** -- All spacing tokens with pixel equivalents and usage context
6. **Layout dimensions** -- Sidebar widths for expanded, mobile, and collapsed states
7. **Hardcoded color audit results** -- List of files with hardcoded emerald/green classes that need future migration
8. **Migration notes** -- Key differences from the old token values (what changed and why)

The document should be practical: a developer (or Claude) working on any subsequent phase can look up "what Tailwind class do I use for X?" and get the answer immediately.
  </action>
  <verify>
1. DESIGN-TOKENS.md exists and contains all sections listed above.
2. The hardcoded color audit section lists specific files and class patterns found.
3. Every token from globals.css is documented with both light and dark values.
4. Run `pnpm test:run` to confirm existing tests still pass (the token changes should not break unit tests since they test behavior, not styles).
  </verify>
  <done>DESIGN-TOKENS.md is a comprehensive reference for all design tokens. Hardcoded emerald/green usage is documented. Existing tests pass, confirming no functional regressions from the CSS changes.</done>
</task>

</tasks>

<verification>
1. `pnpm build` passes
2. `pnpm lint` passes
3. `pnpm test:run` passes (no functional regressions)
4. tailwind.config.ts registers: page, highlight, sidebar (with all sub-colors), fontSize scale, spacing scale, width for sidebar
5. DESIGN-TOKENS.md exists with complete token reference
6. Hardcoded emerald/green audit is documented
7. New Tailwind utilities confirmed available: bg-page, bg-highlight, bg-sidebar, text-page-title, p-card-padding, w-sidebar
</verification>

<success_criteria>
- All new CSS tokens are usable as Tailwind utility classes
- Hardcoded color classes are audited and documented (not changed -- future phase work)
- DESIGN-TOKENS.md provides a complete reference for subsequent phases
- All tests (build, lint, unit) pass
</success_criteria>

<output>
After completion, create `.planning/phases/01-design-token-extraction-css-foundation/01-02-SUMMARY.md`
</output>
