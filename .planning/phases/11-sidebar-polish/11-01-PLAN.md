---
phase: 11-sidebar-polish
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - app/globals.css
  - tailwind.config.ts
  - components/ui/sidebar.tsx
  - components/layouts/app-sidebar.tsx
  - components/layouts/sidebar-user-footer.tsx
autonomous: true
requirements: [SIDE-01, SIDE-02, SIDE-03]

must_haves:
  truths:
    - "Sidebar is 224px wide (expanded) with nav items at 36px height"
    - "Nav items are a flat list (Dashboard, Habits, Tasks) with no group headers or collapsible sections"
    - "Settings nav item is removed from the sidebar (accessible only via footer dropdown)"
    - "Each nav item icon is wrapped in a 24x24px white container box with 8px border-radius"
    - "Hovering a nav item shows a teal-tinted background with inset ring and smooth 0.2s transition"
    - "Active nav item shows a light blue-gray background with subtle inset ring"
    - "All nav items use font-weight 600 (semibold) regardless of active state"
    - "Footer dropdown trigger uses a gear (Settings) icon instead of ChevronsUpDown"
    - "Footer button has the same teal hover treatment as nav items"
  artifacts:
    - path: "app/globals.css"
      provides: "Sidebar hover/active CSS tokens and updated sidebar width"
      contains: "--sidebar-hover-bg"
    - path: "components/layouts/app-sidebar.tsx"
      provides: "Restructured flat sidebar with icon containers and Chameleon styling"
      min_lines: 50
    - path: "components/layouts/sidebar-user-footer.tsx"
      provides: "Updated footer with gear icon and hover treatment"
      contains: "Settings"
  key_links:
    - from: "components/layouts/app-sidebar.tsx"
      to: "app/globals.css"
      via: "CSS custom properties for hover/active states"
      pattern: "sidebar-hover|sidebar-active"
    - from: "components/layouts/app-sidebar.tsx"
      to: "components/ui/sidebar.tsx"
      via: "SidebarMenuButton with className overrides"
      pattern: "SidebarMenuButton"
---

<objective>
Restructure and restyle the sidebar to match the Chameleon design reference -- flat navigation, icon containers, smooth hover/active transitions, and polished footer.

Purpose: Transform the sidebar from a collapsible-group layout to a clean flat list matching Chameleon's intentional, polished feel with consistent spacing and smooth interactions.
Output: Fully restyled sidebar with new tokens, flat nav structure, icon containers, hover/active states, and updated footer.
</objective>

<execution_context>
@/home/xingdi/.claude/get-shit-done/workflows/execute-plan.md
@/home/xingdi/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/11-sidebar-polish/11-CONTEXT.md
@app/globals.css
@tailwind.config.ts
@components/ui/sidebar.tsx
@components/layouts/app-sidebar.tsx
@components/layouts/sidebar-user-footer.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add sidebar hover/active design tokens and update sidebar width</name>
  <files>app/globals.css, tailwind.config.ts, components/ui/sidebar.tsx</files>
  <action>
**globals.css -- Light mode (:root):**
Add new CSS variables for hover and active states (place after existing sidebar variables):
- `--sidebar-hover-bg: 166 50% 94%;` (teal tint, adapted from Chameleon's green `rgb(233,249,239)` to our teal brand)
- `--sidebar-hover-ring: 160 55% 72%;` (teal ring, adapted from Chameleon's `rgb(167,232,191)`)
- `--sidebar-hover-text: 157 63% 30%;` (darker teal for hover text)
- `--sidebar-active-bg: 216 24% 95%;` (keep existing `--sidebar-accent` value -- light blue-gray matching Chameleon's `rgb(238,241,246)`)
- `--sidebar-active-ring: 214 20% 82%;` (subtle gray ring matching Chameleon's `rgb(203,213,225)`)
- `--sidebar-icon-bg: 0 0% 100%;` (white icon container background)
- `--sidebar-item-radius: 12px;` (pill-shaped nav items)

Update existing sidebar width: `--sidebar-width: 224px;` (was 200px, per user decision)

**globals.css -- Dark mode (.dark):**
Add dark mode equivalents (Claude's discretion per CONTEXT.md):
- `--sidebar-hover-bg: 160 25% 16%;` (subtle teal tint on dark)
- `--sidebar-hover-ring: 160 30% 28%;` (muted teal ring)
- `--sidebar-hover-text: 160 40% 70%;` (lighter teal text)
- `--sidebar-active-bg: 240 15% 18%;` (keep same as `--sidebar-accent`)
- `--sidebar-active-ring: 240 15% 25%;` (subtle border ring)
- `--sidebar-icon-bg: 240 20% 20%;` (dark elevated surface for icon container)
- `--sidebar-item-radius: 12px;` (same in both themes)

**tailwind.config.ts:**
Add new sidebar color utilities under the existing `sidebar` color object:
```ts
"hover-bg": "hsl(var(--sidebar-hover-bg))",
"hover-ring": "hsl(var(--sidebar-hover-ring))",
"hover-text": "hsl(var(--sidebar-hover-text))",
"active-bg": "hsl(var(--sidebar-active-bg))",
"active-ring": "hsl(var(--sidebar-active-ring))",
"icon-bg": "hsl(var(--sidebar-icon-bg))",
```

**components/ui/sidebar.tsx:**
Update the width constants to match the new 224px sidebar width:
- `SIDEBAR_WIDTH` from `"12.5rem"` to `"14rem"` (224px)
- Leave `SIDEBAR_WIDTH_MOBILE` and `SIDEBAR_WIDTH_ICON` unchanged (mobile sheet and collapsed icon rail stay the same)

Note: This is one of the rare cases where editing `components/ui/sidebar.tsx` is necessary because the width constants are hardcoded as inline styles in SidebarProvider and override the CSS variable. The alternative (leaving the mismatch) would cause the sidebar to render at 12.5rem despite the CSS saying 224px.
  </action>
  <verify>Run `pnpm build` -- no type errors, no build failures. Grep globals.css for `--sidebar-hover-bg` and `--sidebar-width: 224px` to confirm tokens exist.</verify>
  <done>All new sidebar tokens defined in both light and dark mode, Tailwind utilities registered, sidebar width updated to 224px in both CSS and component constant.</done>
</task>

<task type="auto">
  <name>Task 2: Restructure AppSidebar to flat nav with icon containers and Chameleon styling</name>
  <files>components/layouts/app-sidebar.tsx</files>
  <action>
Complete rewrite of `app-sidebar.tsx` to match Chameleon reference. Key changes:

**1. Remove collapsible groups and flatten navigation (per user decision):**
- Remove `accountNavItems` array entirely (Settings removed from sidebar nav -- accessible via footer dropdown)
- Remove all `Collapsible`, `CollapsibleTrigger`, `CollapsibleContent` imports and wrappers
- Remove `SidebarGroupLabel` import and usage (no group headers)
- Remove `ChevronDown` import (no collapsible triggers)
- Remove `Settings` icon import (no longer needed in nav)
- Keep single `SidebarGroup` > `SidebarGroupContent` > `SidebarMenu` wrapping all 3 nav items (Dashboard, Habits, Tasks)

**2. Nav items: `mainNavItems` stays as-is** (3 items: Dashboard, Habits, Tasks)

**3. Add icon container component** (inline or as a small helper):
Each nav icon gets wrapped in a container box:
```tsx
<div className="flex size-6 shrink-0 items-center justify-center rounded-lg bg-sidebar-icon-bg">
  <item.icon className="size-3.5" />
</div>
```
- Container: 24x24px (`size-6`), border-radius 8px (`rounded-lg`), white background (`bg-sidebar-icon-bg`)
- Icon inside: 14px (`size-3.5`)
- 8px gap between icon container and label -- use `gap-2` on the parent (SidebarMenuButton already has `gap-2`)

**4. Apply Chameleon styling via className overrides on SidebarMenuButton:**
Override the default `SidebarMenuButton` classes. Use the `className` prop to add:
- Height: `h-9` (36px, overrides default `h-8`)
- Padding: use inline `style={{ padding: '6px 12px 6px 6px' }}` for the asymmetric Chameleon padding (per user decision)
- Border radius: `rounded-xl` (Tailwind's 12px, matches `--sidebar-item-radius`)
- Font: `font-semibold text-sm` (14px, weight 600 for ALL items)
- Transition: `transition-all duration-200 ease-[cubic-bezier(0.4,0,0.2,1)]`

**5. Hover state styling** (override SidebarMenuButton defaults):
Use className to replace the default hover behavior:
```
hover:bg-sidebar-hover-bg hover:text-sidebar-hover-text hover:shadow-[inset_0_0_0_0.5px_hsl(var(--sidebar-hover-ring))]
```

**6. Active state styling** (override `data-[active=true]` defaults):
```
data-[active=true]:bg-sidebar-active-bg data-[active=true]:text-sidebar-accent-foreground data-[active=true]:shadow-[inset_0_0_0_0.5px_hsl(var(--sidebar-active-ring))] data-[active=true]:font-semibold
```

**7. Ensure badge rendering still works** -- the `SidebarMenuBadge` should still render alongside the new menu button structure.

**8. Collapsed (icon-only) mode:**
The icon container should still show in collapsed mode. The `group-data-[collapsible=icon]:!size-8 group-data-[collapsible=icon]:!p-2` from the base variant handles sizing. The icon container will be the main visible element.

**Important: Do NOT remove the pin toggle button from the sidebar header.** Keep the existing brand logo + pin button header section.
  </action>
  <verify>Run `pnpm build` to confirm no type/import errors. Visually: the sidebar should render 3 nav items (Dashboard, Habits, Tasks) in a flat list with no group headers, each with a white icon container box.</verify>
  <done>AppSidebar renders a flat list of 3 nav items with icon containers, Chameleon-matched spacing/sizing, smooth hover transitions with teal tint and inset ring, and active state with blue-gray background and inset ring. No collapsible groups. No Settings in nav.</done>
</task>

<task type="auto">
  <name>Task 3: Update sidebar user footer icon and hover treatment</name>
  <files>components/layouts/sidebar-user-footer.tsx</files>
  <action>
**1. Replace ChevronsUpDown icon with Settings (gear) icon (per user decision):**
- Change import: remove `ChevronsUpDown` from lucide-react imports (if not already imported, `Settings` is already imported -- verify and deduplicate)
- In the DropdownMenuTrigger's SidebarMenuButton, replace `<ChevronsUpDown className="ml-auto size-4" />` with `<Settings className="ml-auto size-4" />`

**2. Apply teal/primary hover treatment to footer button (per user decision):**
Update the SidebarMenuButton className in the DropdownMenuTrigger to add the same hover treatment as nav items:
```
hover:bg-sidebar-hover-bg hover:text-sidebar-hover-text hover:shadow-[inset_0_0_0_0.5px_hsl(var(--sidebar-hover-ring))]
transition-all duration-200 ease-[cubic-bezier(0.4,0,0.2,1)]
```

Also update the `data-[state=open]` styling to use the active/hover treatment instead of the default accent:
```
data-[state=open]:bg-sidebar-hover-bg data-[state=open]:text-sidebar-hover-text data-[state=open]:shadow-[inset_0_0_0_0.5px_hsl(var(--sidebar-hover-ring))]
```
(replaces the existing `data-[state=open]:bg-sidebar-accent data-[state=open]:text-sidebar-accent-foreground`)

**3. Clean up imports:**
Remove `ChevronsUpDown` from the lucide-react import line. `Settings` is already imported (used in the dropdown menu item for the settings link).
  </action>
  <verify>Run `pnpm build` -- no errors. Verify in the source that `ChevronsUpDown` is no longer imported and `Settings` icon is used in the footer trigger.</verify>
  <done>Footer dropdown trigger shows a gear (Settings) icon and applies the same teal hover/active treatment as the main nav items, with smooth 0.2s transition.</done>
</task>

</tasks>

<verification>
1. `pnpm build` completes without errors
2. `pnpm lint` passes (or only pre-existing warnings)
3. Sidebar width is 224px -- verify `--sidebar-width: 224px` in globals.css and `SIDEBAR_WIDTH = "14rem"` in sidebar.tsx
4. No `Collapsible` imports remain in app-sidebar.tsx
5. No `accountNavItems` or Settings nav link in app-sidebar.tsx
6. `grep -c "sidebar-hover-bg" app/globals.css` returns 2 (light + dark)
7. `grep "ChevronsUpDown" components/layouts/sidebar-user-footer.tsx` returns nothing
</verification>

<success_criteria>
- Sidebar renders at 224px with 3 flat nav items (Dashboard, Habits, Tasks) -- no group headers
- Each icon wrapped in 24x24 white container with 8px radius
- Hover produces teal background + inset ring with 0.2s cubic-bezier transition
- Active item shows blue-gray background + inset ring
- All nav items use font-semibold (600) regardless of state
- Footer uses gear icon with matching hover treatment
- Build and lint pass
</success_criteria>

<output>
After completion, create `.planning/phases/11-sidebar-polish/11-01-SUMMARY.md`
</output>
