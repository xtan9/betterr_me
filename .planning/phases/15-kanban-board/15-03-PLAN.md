---
phase: 15-kanban-board
plan: 03
type: execute
wave: 3
depends_on: ["15-02"]
files_modified:
  - components/kanban/kanban-detail-modal.tsx
  - components/kanban/kanban-quick-add.tsx
  - components/kanban/kanban-board.tsx
autonomous: true
requirements: [KANB-05, PAGE-03]

must_haves:
  truths:
    - "Clicking a kanban card opens a full overlay modal with task details"
    - "Detail modal has two-panel layout: left panel with task fields, right panel with comments placeholder"
    - "Detail modal has Details and Activity tabs (Activity shows placeholder)"
    - "Quick-add input appears on column hover and creates a task in that column's status"
    - "Quick-add pre-fills project_id, section, and status from the column context"
  artifacts:
    - path: "components/kanban/kanban-detail-modal.tsx"
      provides: "Monday.com-style full overlay task detail modal"
      contains: "Dialog"
    - path: "components/kanban/kanban-quick-add.tsx"
      provides: "Hover-visible quick-add input for creating tasks in a column"
  key_links:
    - from: "components/kanban/kanban-board.tsx"
      to: "components/kanban/kanban-detail-modal.tsx"
      via: "selectedTask state controls modal open/close"
      pattern: "KanbanDetailModal"
    - from: "components/kanban/kanban-quick-add.tsx"
      to: "/api/tasks"
      via: "POST to create new task"
      pattern: "fetch.*api/tasks"
    - from: "components/kanban/kanban-board.tsx"
      to: "components/kanban/kanban-quick-add.tsx"
      via: "passed to each KanbanColumn"
      pattern: "KanbanQuickAdd"
---

<objective>
Add the Monday.com-style task detail popup and column quick-add input to complete the kanban board interaction model.

Purpose: Users can view task details without leaving the board (card click opens detail modal) and quickly create new tasks in any column (hover reveals input).
Output: KanbanDetailModal, KanbanQuickAdd components wired into KanbanBoard.
</objective>

<execution_context>
@/home/xingdi/.claude/get-shit-done/workflows/execute-plan.md
@/home/xingdi/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/15-kanban-board/15-CONTEXT.md
@.planning/phases/15-kanban-board/15-RESEARCH.md
@.planning/phases/15-kanban-board/15-02-SUMMARY.md
@components/kanban/kanban-board.tsx
@components/kanban/kanban-column.tsx
@lib/db/types.ts
@lib/tasks/format.ts
@lib/projects/colors.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create KanbanDetailModal and KanbanQuickAdd components</name>
  <files>
    components/kanban/kanban-detail-modal.tsx
    components/kanban/kanban-quick-add.tsx
  </files>
  <action>
1. **Create `components/kanban/kanban-detail-modal.tsx`:**
   - `"use client"` directive
   - Props: `{ task: Task | null; onClose: () => void; projectName?: string }`
   - Uses shadcn `Dialog` with `DialogContent` max-width override (`max-w-4xl max-h-[90vh] p-0`)
   - `open` controlled by `!!task`, `onOpenChange` calls `onClose` when closing

   **Monday.com-style layout (per CONTEXT locked decisions):**

   a. **Header area** (inside DialogContent, above tabs):
      - Task title: `text-xl font-semibold`
      - Below title: `Tabs` with two triggers: "Details" and "Activity" (using shadcn Tabs/TabsList/TabsTrigger)
      - Use i18n: `t("kanban.detail.detailsTab")`, `t("kanban.detail.activityTab")`

   b. **Details tab content** â€” two-panel flex layout:
      - **Left panel** (`flex-1 p-6 space-y-4 overflow-y-auto`):
        - Status field: label + Badge showing current status with status-appropriate color
        - Priority field: label + Badge with priority color (same as card)
        - Section field: label + text (Personal/Work)
        - Project field: label + text (projectName or dash)
        - Due date field: label + formatted date or `t("kanban.detail.noDueDate")`
        - Description field: label + text or `t("kanban.detail.noDescription")`
        - "Edit Task" button at bottom: navigates to `/tasks/${task.id}/edit` using `useRouter`
        - All labels use `t("kanban.detail.{field}")` i18n keys
      - **Right panel** (`w-80 border-l p-6 bg-muted/30`):
        - Placeholder text: `t("kanban.detail.commentsPlaceholder")`
        - Styled as empty state: muted text, centered

   c. **Activity tab content:**
      - Full-width placeholder: `t("kanban.detail.activityPlaceholder")`
      - Styled as empty state

   **Status badge colors** (Claude's discretion):
   - backlog: `bg-muted text-muted-foreground`
   - todo: `bg-slate-500 text-white`
   - in_progress: `bg-blue-500 text-white`
   - done: `bg-green-500 text-white`

2. **Create `components/kanban/kanban-quick-add.tsx`:**
   - `"use client"` directive
   - Props: `{ status: TaskStatus; projectId: string; projectSection: string; onTaskCreated: () => void }`
   - Renders a form with a single `Input` (from shadcn) and hidden submit
   - Placeholder: `t("kanban.quickAdd.placeholder")`
   - On submit:
     ```typescript
     const res = await fetch("/api/tasks", {
       method: "POST",
       headers: { "Content-Type": "application/json" },
       body: JSON.stringify({
         title: value.trim(),
         status,
         section: projectSection,
         project_id: projectId,
         priority: 0,
       }),
     });
     ```
   - On success: clear input, call `onTaskCreated()` (triggers SWR revalidation in parent)
   - On error: `toast.error(t("kanban.createError"))`
   - Input auto-focuses when rendered
   - Form submits on Enter, blurring the input hides it (parent controls visibility)
  </action>
  <verify>
    - `pnpm lint` passes for new files
    - Both files exist and export named components
    - `grep "Dialog" components/kanban/kanban-detail-modal.tsx` confirms Dialog usage
    - `grep "fetch.*api/tasks" components/kanban/kanban-quick-add.tsx` confirms POST call
  </verify>
  <done>
    - KanbanDetailModal shows Monday.com-style overlay with left details + right placeholder
    - Detail modal has Details/Activity tabs with proper i18n
    - KanbanQuickAdd creates tasks with project_id, status, section pre-filled
  </done>
</task>

<task type="auto">
  <name>Task 2: Wire detail modal and quick-add into KanbanBoard and KanbanColumn</name>
  <files>
    components/kanban/kanban-board.tsx
    components/kanban/kanban-column.tsx
  </files>
  <action>
1. **Wire KanbanDetailModal into `kanban-board.tsx`:**
   - Import `KanbanDetailModal`
   - The `selectedTask` state already exists from Plan 02
   - Render at the bottom of the board JSX:
     ```tsx
     <KanbanDetailModal
       task={selectedTask}
       onClose={() => setSelectedTask(null)}
       projectName={project?.name}
     />
     ```

2. **Wire KanbanQuickAdd into `kanban-column.tsx`:**
   - Add props to KanbanColumn: `projectId: string`, `projectSection: string`, `onTaskCreated: () => void`
   - Add hover state: `const [isHovered, setIsHovered] = useState(false)`
   - Wrap the column outer div with `onMouseEnter={() => setIsHovered(true)}` and `onMouseLeave={() => setIsHovered(false)}`
   - At the bottom of the card list (after all cards, before ScrollArea closes), conditionally render:
     ```tsx
     {isHovered && (
       <KanbanQuickAdd
         status={status}
         projectId={projectId}
         projectSection={projectSection}
         onTaskCreated={onTaskCreated}
       />
     )}
     ```
   - Position: after last card (per CONTEXT: "positioned after the last card")
   - For empty columns: quick-add appears as the first element (per CONTEXT: "or first position if column is empty")

3. **Update KanbanBoard to pass new props to KanbanColumn:**
   - Pass `projectId={projectId}` to each column
   - Pass `projectSection={project?.section ?? "personal"}` to each column
   - Pass `onTaskCreated={() => tasksMutate()}` to each column (triggers SWR revalidation of task list)

4. **Verify the full flow works end-to-end:**
   - Card click opens detail modal with task info
   - Closing modal (X or overlay click) clears selectedTask
   - Hovering column shows quick-add input
   - Typing + Enter creates task in that column
   - New task appears in the column after SWR revalidation
  </action>
  <verify>
    - `pnpm lint` passes
    - `pnpm build` succeeds
    - `grep "KanbanDetailModal" components/kanban/kanban-board.tsx` confirms modal wired
    - `grep "KanbanQuickAdd" components/kanban/kanban-column.tsx` confirms quick-add wired
    - `pnpm test:run` passes with no regressions
  </verify>
  <done>
    - Clicking a kanban card opens the detail modal showing task fields
    - Detail modal Edit button links to /tasks/[id]/edit
    - Hovering a column reveals quick-add input at the bottom of card list
    - Quick-add creates a task with correct project_id, status, and section
    - SWR revalidates after task creation, showing the new card
  </done>
</task>

</tasks>

<verification>
- `pnpm test:run` passes with no regressions
- `pnpm lint` passes
- `pnpm build` succeeds
- Full kanban interaction verified:
  1. Click project card -> navigates to kanban board
  2. Board shows 4 columns with tasks sorted by priority
  3. Drag card between columns -> status updates (persists on reload)
  4. Click card -> detail modal opens with task info
  5. Hover column -> quick-add input appears -> Enter creates task in that column
</verification>

<success_criteria>
- Card click opens Monday.com-style detail modal with two-panel layout
- Detail modal has Details and Activity tabs
- Edit button navigates to task edit page
- Quick-add appears on column hover, creates task with correct pre-fills
- All new strings use i18n translations
</success_criteria>

<output>
After completion, create `.planning/phases/15-kanban-board/15-03-SUMMARY.md`
</output>
